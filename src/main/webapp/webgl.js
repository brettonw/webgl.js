let LogLevel=function(){let t=Object.create(null);t.TRACE=0;t.INFO=1;t.WARNNG=2;t.ERROR=3;let e=t.ERROR;t.set=function(t){e=t};let n=["TRC","INF","WRN","ERR"];t.say=function(t,r){if(t>=e){console.log(n[t]+": "+r)}};t.trace=function(e){this.say(t.TRACE,e)};t.info=function(e){this.say(t.INFO,e)};t.warn=function(e){this.say(t.WARNNG,e)};t.error=function(e){this.say(t.ERROR,e)};return t}();let Utility=function(){let t=Object.create(null);const e=Math.PI*2;let n=t.unwind=function(t,e){t-=Math.floor(t/e)*e;while(t>=e){t-=e}while(t<0){t+=e}return t};t.unwindRadians=function(n){return t.unwind(n,e)};t.unwindDegrees=function(e){return t.unwind(e,360)};t.degreesToRadians=function(t){return n(t/180,2)*Math.PI};t.cos=function(e){return Math.cos(t.degreesToRadians(e))};t.sin=function(e){return Math.sin(t.degreesToRadians(e))};t.tan=function(e){return Math.tan(t.degreesToRadians(e))};t.radiansToDegrees=function(t){return n(t,e)/Math.PI*180};t.uppercase=function(t){return t[0].toUpperCase()+t.slice(1)};t.lowercase=function(t){return t[0].toLowerCase()+t.slice(1)};t.flatten=function(t){let e=[];for(let n of t){for(let t of n){e.push(t)}}return e};t.fixNum=function(t,e){e=typeof e!=="undefined"&&e!=null?e:7;return Number.parseFloat(t.toFixed(e))};t.padNum=function(t,e,n){n=n||"0";t=t+"";return t.length>=e?t:new Array(e-t.length+1).join(n)+t};t.defaultValue=function(t,e){return t=typeof t!=="undefined"&&t!=null?t:e};t.defaultFunction=function(t,e){return t=typeof t!=="undefined"&&t!=null?t:e()};t.reverseMap=function(t){let e=Object.create(null);for(let n in t){e[t[n]]=n}return e};return t}();let ClassBase=function(){let t=Object.create(null);t.new=function(t){let e=Object.create(this);if("construct"in e){t=typeof t!=="undefined"&&t!=null?t:Object.create(null);e.construct(t)}return e};return t}();const CLASS_NAME_REQUIRED="CLASS_NAME_REQUIRED";const CLASS_NAME_GENERATED="CLASS_NAME_GENERATED";const CLASS_NAME_OPTIONAL="CLASS_NAME_OPTIONAL";let ClassNamed=function(t){t=typeof t!=="undefined"&&t!=null?t:CLASS_NAME_OPTIONAL;let e=Object.create(ClassBase);let n=Object.create(null);let r=0;let i=function(e){if(typeof e!=="undefined"&&e!=null){if(!(e in n)){return e}throw"Duplicate name ("+e+")"}switch(t){case CLASS_NAME_REQUIRED:throw"Name is required";case CLASS_NAME_GENERATED:return"id"+Utility.padNum(++r,5);case CLASS_NAME_OPTIONAL:return null}};e.new=function(t,r){t=typeof t!=="undefined"&&t!=null?t:Object.create(null);if((r=i(r))!=null)t.name=r;let o=Object.getPrototypeOf(e).new.call(this,t);if(r!=null){o.name=r;n[r]=o}return o};e.get=function(t){return n[t]};e.getName=function(){return"name"in this?this.name:"node"};e.getIndex=function(){return n};e.forEach=function(t){for(let e in n){let r=n[e];t(r)}};return e};let OnReady=function(){let t=Object.create(null);t.construct=function(t,e){this.scope=t;this.callback=e;return this};t.notify=function(t){this.callback.call(this.scope,t)};t.new=function(e,n){return Object.create(t).construct(e,n)};return t}();"use strict;";let MouseTracker=function(){let t=Object.create(null);let e;let n;let r;let i;let o=function(t){return{x:(t.clientX-n.left)/n.width,y:(t.clientY-n.top)/n.height}};let a=function(t){let n=o(t);let i=[n.x-e.x,n.y-e.y];if(Float2.normSq(i)>0){e=n;r.notify(i)}};let s=function(t){window.removeEventListener("mousemove",a,false);window.removeEventListener("mouseup",s,false)};let u=function(t){if(t.button===0){e=o(t);window.addEventListener("mousemove",a,false);window.addEventListener("mouseup",s,false)}};let c=37;let l=39;let f=function(t){switch(t.keyCode){case c:r.notify([-i,0]);break;case l:r.notify([i,0]);break;default:r.notify([0,0]);break}};t.construct=function(t,e,o){r=e;i=o=typeof o!=="undefined"&&o!=null?o:.05;let a=document.getElementById(t);n=a.getBoundingClientRect();a.addEventListener("mousedown",u,false);a.addEventListener("keydown",f,true);a.focus()};t.new=function(e,n,r){return Object.create(t).construct(e,n,r)};return t}();let DocumentHelper=function(){let t=Object.create(ClassBase);t.element=function(t){this[t]=document.getElementById(t);return this};t.elements=function(...t){for(let e of t){this.element(e)}return this};t.all=function(){return this};return t}();"use strict;";let RollingStats=function(){let t=Object.create(ClassBase);t.construct=function(t){this.count=Utility.defaultValue(t.count,10);if("fill"in t){this.fill=t.fill}this.reset()};t.update=function(t){this.sum+=t;if(this.history.length<this.count){this.history.push(t)}else{this.sum-=this.history[this.current];this.history[this.current]=t;this.current=(this.current+1)%this.count}let e=this.sum/this.history.length;let n=Number.POSITIVE_INFINITY;let r=Number.NEGATIVE_INFINITY;let i=0;for(let t of this.history){r=Math.max(t,r);n=Math.min(t,n);let o=t-e;i+=o*o}i/=this.count;return{min:n,max:r,avg:e,var:i,std:Math.sqrt(i)}};t.reset=function(){this.history=[];this.sum=0;if("fill"in this){for(let t=0;t<this.count;++t){this.history.push(this.fill);this.sum+=this.fill}}this.current=0};return t}();let FloatN=function(dim){let _=Object.create(null);_.create=function(){return new Float32Array(dim)};eval(function(){let t="_.copy = function (from, to) {\n";t+="to = (typeof to !== 'undefined') ? to : _.create ();\n";for(let e=0;e<dim;++e){t+="to["+e+"] = from["+e+"];\n"}t+="return to;\n";t+="};\n";return t}());eval(function(){let t="_.point = function (from, to) {\n";t+="to = (typeof to !== 'undefined') ? to : _.create ();\n";let e=dim-1;for(let n=0;n<e;++n){t+="to["+n+"] = from["+n+"];\n"}t+="to["+e+"] = 1;\n";t+="return to;\n";t+="};\n";return t}());eval(function(){let t="_.vector = function (from, to) {\n";t+="to = (typeof to !== 'undefined') ? to : _.create ();\n";let e=dim-1;for(let n=0;n<e;++n){t+="to["+n+"] = from["+n+"];\n"}t+="to["+e+"] = 0;\n";t+="return to;\n";t+="};\n";return t}());eval(function(){let t="_.dot = function (left, right) {\n";t+="return (left[0] * right[0])";for(let e=1;e<dim;++e){t+="\n + (left["+e+"] * right["+e+"])"}t+=";\n";t+="};\n";return t}());_.normSq=function(t){return _.dot(t,t)};_.norm=function(t){let e=_.normSq(t);return e>0?Math.abs(e-1)>1e-6?Math.sqrt(e):1:0};_.normalize=function(t,e){let n=_.norm(t);return Math.abs(n-1)>1e-6?_.scale(t,1/n,e):_.copy(t,e)};eval(function(){let t="_.add = function (left, right, to) {\n";t+="to = (typeof to !== 'undefined') ? to : _.create ();\n";for(let e=0;e<dim;++e){t+="to["+e+"] = left["+e+"] + right["+e+"];\n"}t+="return to;\n";t+="};\n";return t}());eval(function(){let t="_.subtract = function (left, right, to) {\n";t+="to = (typeof to !== 'undefined') ? to : _.create ();\n";for(let e=0;e<dim;++e){t+="to["+e+"] = left["+e+"] - right["+e+"];\n"}t+="return to;\n";t+="};\n";return t}());eval(function(){let t="_.scale = function (from, scale, to) {\n";t+="to = (typeof to !== 'undefined') ? to : _.create ();\n";for(let e=0;e<dim;++e){t+="to["+e+"] = from["+e+"] * scale;\n"}t+="return to;\n";t+="};\n";return t}());eval(function(){let t="_.fixNum = function (from, precision, to) {\n";t+="to = (typeof to !== 'undefined') ? to : _.create ();\n";for(let e=0;e<dim;++e){t+="to["+e+"] = Utility.fixNum (from["+e+"], precision);\n"}t+="return to;\n";t+="};\n";return t}());eval(function(){let t="_.minor = function (from) {\n";t+="let minorIndex = 0, minorValue = from[minorIndex];\n";for(let e=1;e<dim;++e){t+="nextValue = from["+e+"]; ";t+="if (minorValue > nextValue) { minorIndex = "+e+"; minorValue = nextValue;};\n"}t+="return minorIndex;\n";t+="};\n";return t}());eval(function(){let t="_.major = function (from) {\n";t+="let majorIndex = 0, majorValue = from[majorIndex];\n";for(let e=1;e<dim;++e){t+="nextValue = from["+e+"]; ";t+="if (majorValue < nextValue) { majorIndex = "+e+"; majorValue = nextValue;};\n"}t+="return majorIndex;\n";t+="};\n";return t}());eval(function(){let t="_.str = function (from) {\n";t+="return '(' + from[0]";for(let e=1;e<dim;++e){t+="\n + ', ' +  + from["+e+"].toFixed (7)"}t+=" + ')';\n";t+="};\n";return t}());_.equals=function(t,e){return _.str(t)===_.str(e)};return _};let Float2=function(){let t=FloatN(2);t.perpendicular=function(e,n){n=n=typeof n!=="undefined"&&n!=null?n:t.create();n[0]=e[1];n[1]=-e[0];return n};t.cross=function(t,e){return t[0]*e[1]-t[1]*e[0]};return t}();let Float3=function(){let t=FloatN(3);t.cross=function(e,n,r){r=r=typeof r!=="undefined"&&r!=null?r:t.create();r[0]=e[1]*n[2]-e[2]*n[1];r[1]=e[2]*n[0]-e[0]*n[2];r[2]=e[0]*n[1]-e[1]*n[0];return r};return t}();let Float4=function(){return FloatN(4)}();let FloatNxN=function(dim){let _=Object.create(null);let _FloatN=FloatN(dim);let size=dim*dim;let index=_.index=function(t,e){return t*dim+e};let defineTo=function(t){t=typeof t!=="undefined"&&t!=null?t:"to";return t+" = (typeof "+t+" !== 'undefined') ? "+t+" : _.create ();\n"};_.create=function(){return new Float32Array(size)};eval(function(){let t="_.copy = function (from, to) {\n";t+=defineTo();for(let e=0;e<dim;++e){for(let n=0;n<dim;++n){let r=index(e,n);t+="to["+r+"] = from["+r+"]; "}t+="\n"}t+="return to;\n";t+="};\n";return t}());eval(function(){let t="_.identity = function (to) {\n";t+=defineTo();for(let e=0;e<dim;++e){for(let n=0;n<dim;++n){t+="to["+index(e,n)+"] = "+(e===n?1:0)+"; "}t+="\n"}t+="return to;\n";t+="};\n";return t}());_.IDENTITY=_.identity();eval(function(){let t="_.transpose = function (from, to) {\n";t+=defineTo();for(let e=0;e<dim;++e){for(let n=0;n<dim;++n){t+="to["+index(e,n)+"] = from["+index(n,e)+"]; "}t+="\n"}t+="return to;\n";t+="};\n";return t}());eval(function(){let t=function(t,e){let n="(left["+index(t,0)+"] * right["+index(0,e)+"])";for(let r=1;r<dim;++r){n+=" + (left["+index(t,r)+"] * right["+index(r,e)+"])"}n+=";\n";return n};let e="_.multiply = function (left, right, to) {\n";e+=defineTo();for(let n=0;n<dim;++n){for(let r=0;r<dim;++r){e+="to["+index(n,r)+"] = "+t(n,r)}}e+="return to;\n";e+="};\n";return e}());_.chain=function(...t){let e=t[0];for(let n=1,r=t.length;n<r;++n){let r=t[n];e=_.multiply(e,r)}return e};eval(function(){let t=dim-1;let e="_.scale = function (scale, to) {\n";e+="scale = Array.isArray(scale) ? scale : Array("+t+").fill(scale);\n";e+="to = _.identity (to);\n";for(let n=0;n<t;++n){e+="to["+index(n,n)+"] = scale["+n+"]; "}e+="\n";e+="return to;\n";e+="};\n";return e}());eval(function(){let t=dim-1;let e="_.translate = function (translate, to) {\n";e+="to = _.identity (to);\n";for(let n=0;n<t;++n){e+="to["+index(t,n)+"] = translate["+n+"]; "}e+="\n";e+="return to;\n";e+="};\n";return e}());eval(function(){let t=function(t){let e="'(' + from["+index(t,0)+"]";for(let n=1;n<dim;++n){e+=" + ', ' + from["+index(t,n)+"]"}e+=" + ')'";return e};let e="_.str = function (from) {\n";e+="return ";e+=t(0);for(let n=1;n<dim;++n){e+=" + ', ' + "+t(n)}e+=";\n";e+="};\n";return e}());return _};let Float4x4=function(){let t=4;let e=FloatNxN(t);e.inverse=function(t,n){n=n=typeof n!=="undefined"&&n!=null?n:e.create();let r=t[0]*t[5]-t[1]*t[4],i=t[0]*t[6]-t[2]*t[4],o=t[9]*t[14]-t[10]*t[13],a=t[9]*t[15]-t[11]*t[13],s=t[10]*t[15]-t[11]*t[14],u=t[0]*t[7]-t[3]*t[4],c=t[1]*t[6]-t[2]*t[5],l=t[1]*t[7]-t[3]*t[5],f=t[2]*t[7]-t[3]*t[6],d=t[8]*t[13]-t[9]*t[12],h=t[8]*t[14]-t[10]*t[12],x=t[8]*t[15]-t[11]*t[12],m=1/(r*s-i*a+u*o+c*x-l*h+f*d);n[0]=(t[5]*s-t[6]*a+t[7]*o)*m;n[1]=(-t[1]*s+t[2]*a-t[3]*o)*m;n[2]=(t[13]*f-t[14]*l+t[15]*c)*m;n[3]=(-t[9]*f+t[10]*l-t[11]*c)*m;n[4]=(-t[4]*s+t[6]*x-t[7]*h)*m;n[5]=(t[0]*s-t[2]*x+t[3]*h)*m;n[6]=(-t[12]*f+t[14]*u-t[15]*i)*m;n[7]=(t[8]*f-t[10]*u+t[11]*i)*m;n[8]=(t[4]*a-t[5]*x+t[7]*d)*m;n[9]=(-t[0]*a+t[1]*x-t[3]*d)*m;n[10]=(t[12]*l-t[13]*u+t[15]*r)*m;n[11]=(-t[8]*l+t[9]*u-t[11]*r)*m;n[12]=(-t[4]*o+t[5]*h-t[6]*d)*m;n[13]=(t[0]*o-t[1]*h+t[2]*d)*m;n[14]=(-t[12]*c+t[13]*i-t[14]*r)*m;n[15]=(t[8]*c-t[9]*i+t[10]*r)*m;return n};e.preMultiply=function(t,e,n){n=n=typeof n!=="undefined"&&n!=null?n:Float4.create();let r=t[0],i=t[1],o=t[2],a=t[3];n[0]=e[0]*r+e[4]*i+e[8]*o+e[12]*a;n[1]=e[1]*r+e[5]*i+e[9]*o+e[13]*a;n[2]=e[2]*r+e[6]*i+e[10]*o+e[14]*a;n[3]=e[3]*r+e[7]*i+e[11]*o+e[15]*a;return n};e.postMultiply=function(t,e,n){n=n=typeof n!=="undefined"&&n!=null?n:Float4.create();let r=e[0],i=e[1],o=e[2],a=e[3];n[0]=t[0]*r+t[1]*i+t[2]*o+t[3]*a;n[1]=t[4]*r+t[5]*i+t[6]*o+t[7]*a;n[2]=t[8]*r+t[9]*i+t[10]*o+t[11]*a;n[3]=t[12]*r+t[13]*i+t[14]*o+t[15]*a;return n};e.rotateX=function(t){let n=e.identity();n[5]=n[10]=Math.cos(t);n[9]=-(n[6]=Math.sin(t));return n};e.rotateY=function(t){let n=e.identity();n[0]=n[10]=Math.cos(t);n[2]=-(n[8]=Math.sin(t));return n};e.rotateZ=function(t){let n=e.identity();n[0]=n[5]=Math.cos(t);n[4]=-(n[1]=Math.sin(t));return n};let n=function(t,n,r,i,o,a,s){s=s=typeof s!=="undefined"&&s!=null?s:e.create();let u=n-t,c=i-r,l=a-o;s[0]=o*2/u;s[1]=0;s[2]=0;s[3]=0;s[4]=0;s[5]=o*2/c;s[6]=0;s[7]=0;s[8]=(n+t)/u;s[9]=(i+r)/c;s[10]=-(a+o)/l;s[11]=-1;s[12]=0;s[13]=0;s[14]=-2*a*o/l;s[15]=0;return s};e.frustum=n;e.perspective=function(t,e,r,i,o){let a=r*Math.tan(Utility.degreesToRadians(t*.5));let s=a*e;return n(-s,s,-a,a,r,i,o)};e.orthographic=function(t,n,r,i,o,a,s){s=s=typeof s!=="undefined"&&s!=null?s:e.create();let u=n-t,c=i-r,l=a-o;s[0]=2/u;s[1]=0;s[2]=0;s[3]=0;s[4]=0;s[5]=2/c;s[6]=0;s[7]=0;s[8]=0;s[9]=0;s[10]=-2/l;s[11]=0;s[12]=-(t+n)/u;s[13]=-(i+r)/c;s[14]=-(a+o)/l;s[15]=1;return s};let r=function(t,n,r,i){let o=e.create();o[0]=t[0];o[1]=t[1];o[2]=t[2];o[3]=0;o[4]=n[0];o[5]=n[1];o[6]=n[2];o[7]=0;o[8]=r[0];o[9]=r[1];o[10]=r[2];o[11]=0;o[12]=i[0];o[13]=i[1];o[14]=i[2];o[15]=1;return e.inverse(o)};e.viewMatrix=r;let i=function(t,e,n){n=Float3.normalize(Utility.defaultValue(n,[0,1,0]));let i=Float3.normalize(e);let o=Float3.normalize(Float3.cross(n,i));let a=Float3.normalize(Float3.cross(i,o));return r(o,a,i,t)};e.lookFrom=i;e.lookFromAt=function(t,e,n){return i(t,Float3.subtract(t,e),n)};e.lookAt=function(t,e,n,r,o){let a=t/Math.tan(Utility.degreesToRadians(e*.5));let s=Float3.add(r,Float3.scale(n,a/Float3.norm(n)));return i(s,n,o)};e.rotateZAxisTo=function(t,n){n=Utility.defaultFunction(n,function(){return[0,1,0]});t=Float3.normalize(t);let r=Float3.normalize(Float3.cross(n,t));let i=Float3.normalize(Float3.cross(t,r));let o=e.create();o[0]=r[0];o[1]=r[1];o[2]=r[2];o[3]=0;o[4]=i[0];o[5]=i[1];o[6]=i[2];o[7]=0;o[8]=t[0];o[9]=t[1];o[10]=t[2];o[11]=0;o[12]=0;o[13]=0;o[14]=0;o[15]=1;return o};e.rotateXAxisTo=function(t,n){n=Utility.defaultFunction(n,function(){return[0,1,0]});t=Float3.normalize(t);let r=Float3.normalize(Float3.cross(t,n));let i=Float3.normalize(Float3.cross(r,t));let o=e.create();o[0]=t[0];o[1]=t[1];o[2]=t[2];o[3]=0;o[4]=i[0];o[5]=i[1];o[6]=i[2];o[7]=0;o[8]=r[0];o[9]=r[1];o[10]=r[2];o[11]=0;o[12]=0;o[13]=0;o[14]=0;o[15]=1;return o};return e}();let context;let Render=function(){let t=Object.create(ClassBase);t.construct=function(t){let e=document.getElementById(t.canvasDivId);let n=document.createElement("canvas");e.appendChild(n);context=this.context=n.getContext("webgl2",{preserveDrawingBuffer:true});let r=window.devicePixelRatio=typeof window.devicePixelRatio!=="undefined"&&window.devicePixelRatio!=null?window.devicePixelRatio:1;let i=function(t){let e=t[0].target;context.viewportWidth=context.canvas.width=e.clientWidth*r;context.viewportHeight=context.canvas.height=e.clientHeight*r;context.viewport(0,0,context.viewportWidth,context.viewportHeight);context.canvas.style.width=e.clientWidth+"px";context.canvas.style.height=e.clientHeight+"px"};new ResizeObserver(i).observe(e);let o=LoaderList.new().addLoaders(LoaderShader.new("https://brettonw.github.io/webgl.js/src/main/webapp/shaders/@.glsl").addVertexShaders("basic").addFragmentShaders(["basic","basic-texture","color","overlay","rgb","texture","vertex-color"]));if("loaders"in t){o.addLoaders(t.loaders)}let a=this;o.go(OnReady.new(null,function(e){Tetrahedron.make();Hexahedron.make();Octahedron.make();Icosahedron.make();Square.make();Sphere.makeN(2);Sphere.makeN(3);Sphere.makeN(5);Program.new({},"basic");Program.new({vertexShader:"basic"},"basic-texture");Program.new({vertexShader:"basic"},"color");Program.new({vertexShader:"basic"},"overlay");Program.new({vertexShader:"basic"},"rgb");Program.new({vertexShader:"basic"},"texture");Program.new({vertexShader:"basic"},"vertex-color");if(typeof t.onReady!=="undefined"){t.onReady.notify(a)}}))};t.save=function(t){let e="image/png";let n=this.context.canvas.toDataURL(e);let r=document.createElement("a");r.download=t+".png";r.href=n;r.dataset.downloadurl=[e,r.download,r.href].join(":");document.body.appendChild(r);r.click();document.body.removeChild(r)};t.use=function(){context=this.context};return t}();let glMatrixArrayType=Array;let Loader=function(){let t=Object.create(ClassBase);t.construct=function(t){this.items=[];this.onReady=OnReady.new(this,this.finish);return this};t.addItem=function(t,e,n){n.onReady=this.onReady;let r={type:t,name:e,parameters:n};this.items.push(r);return this};t.finish=function(t){if(t===this.pendingItem){delete this.pendingItem;this.next()}else{}};t.go=function(t){this.onFinishedAll=t=typeof t!=="undefined"&&t!=null?t:{notify:function(t){}};this.next()};t.next=function(){if(this.items.length>0){let t=this.items.shift();this.pendingItem=t.type.new(t.parameters,t.name)}else{this.onFinishedAll.notify(this)}};return t}();let LoaderList=function(){let t=Object.create(ClassBase);t.construct=function(t){this.items=[];this.onReady=OnReady.new(this,this.finish);return this};t.addLoaders=function(...t){if(Array.isArray(t[0])){t=t[0]}for(let e of t){this.items.push(e)}return this};t.finish=function(t){if(t===this.pendingItem){delete this.pendingItem;this.next()}else{}};t.next=function(){if(this.items.length>0){let t=this.items.shift();this.pendingItem=t;t.go(this.onReady)}else{this.onFinishedAll.notify(this)}};t.go=function(t){this.onFinishedAll=t=typeof t!=="undefined"&&t!=null?t:{notify:function(t){}};this.next()};return t}();let LoaderPath=function(){let t=Object.create(Loader);t.construct=function(e){Object.getPrototypeOf(t).construct.call(this,e);this.type=e.type;this.path=e.path;return this};t.addItems=function(e,n){e=Array.isArray(e)?e:Array(1).fill(e);for(let r of e){let e=Object.assign(Object.create(null),n,{url:this.path.replace("@",r)});Object.getPrototypeOf(t).addItem.call(this,this.type,r,e)}return this};return t}();let LoaderShader=function(){let t=Object.create(LoaderPath);t.construct=function(e){return Object.getPrototypeOf(t).construct.call(this,{type:Shader,path:e})};let e=function(t,e){t=Array.isArray(t)?t:Array(1).fill(t);let n=[];for(let r of t){n.push(e+"-"+r)}return n};const n=35633;t.addVertexShaders=function(r){return Object.getPrototypeOf(t).addItems.call(this,e(r,"vertex"),{type:n})};const r=35632;t.addFragmentShaders=function(n){return Object.getPrototypeOf(t).addItems.call(this,e(n,"fragment"),{type:r})};return t}();let Shader=function(){let t=ClassNamed();t.construct=function(t){if(typeof t.type==="undefined")throw"Shader type Required";if(typeof t.url==="undefined")throw"Shader URL Required";let e=this;let n=new XMLHttpRequest;n.onload=function(r){if(n.status===200){let r=context.createShader(t.type);context.shaderSource(r,n.responseText);context.compileShader(r);if(!context.getShaderParameter(r,context.COMPILE_STATUS)){}else{e.compiledShader=r}}if(typeof t.onReady!=="undefined"){t.onReady.notify(e)}};n.open("GET",t.url);n.send()};return t}();let Program=function(){let t=ClassNamed(CLASS_NAME_REQUIRED);t.POSITION_ATTRIBUTE="POSITION_ATTRIBUTE";t.NORMAL_ATTRIBUTE="NORMAL_ATTRIBUTE";t.TEXTURE_ATTRIBUTE="TEXTURE_ATTRIBUTE";t.COLOR_ATTRIBUTE="COLOR_ATTRIBUTE";t.MODEL_MATRIX_ATTRIBUTE="MODEL_MATRIX_ATTRIBUTE";let e;t.construct=function(t){t.vertexShader="vertex-"+(t.vertexShader=typeof t.vertexShader!=="undefined"&&t.vertexShader!=null?t.vertexShader:t.name);t.fragmentShader="fragment-"+(t.fragmentShader=typeof t.fragmentShader!=="undefined"&&t.fragmentShader!=null?t.fragmentShader:t.name);if(!("attributeMapping"in t)){t.attributeMapping={POSITION_ATTRIBUTE:"inputPosition",NORMAL_ATTRIBUTE:"inputNormal",TEXTURE_ATTRIBUTE:"inputTexture",COLOR_ATTRIBUTE:"inputColor",MODEL_MATRIX_ATTRIBUTE:"inputModelMatrix"}}if(!("parameterMapping"in t)){t.parameterMapping={MODEL_MATRIX_PARAMETER:"modelMatrix",VIEW_MATRIX_PARAMETER:"viewMatrix",PROJECTION_MATRIX_PARAMETER:"projectionMatrix",CAMERA_POSITION:"cameraPosition",OUTPUT_ALPHA_PARAMETER:"outputAlpha",TEXTURE_SAMPLER:"textureSampler",MODEL_COLOR:"modelColor",AMBIENT_LIGHT_COLOR:"ambientLightColor",AMBIENT_CONTRIBUTION:"ambientContribution",LIGHT_DIRECTION:"lightDirection",LIGHT_COLOR:"lightColor",DIFFUSE_CONTRIBUTION:"diffuseContribution",SPECULAR_CONTRIBUTION:"specularContribution",SPECULAR_EXPONENT:"specularExponent"}}this.currentShape=null;let e=this.program=context.createProgram();context.attachShader(e,Shader.get(t.vertexShader).compiledShader);context.attachShader(e,Shader.get(t.fragmentShader).compiledShader);context.bindAttribLocation(e,0,t.attributeMapping.POSITION_ATTRIBUTE);context.linkProgram(e);if(!context.getProgramParameter(e,context.LINK_STATUS)){}context.useProgram(e);let n=t.parameterMapping;let r=Utility.reverseMap(n);let i=this.standardParameterMapping=Object.create(null);for(let t=0,n=context.getProgramParameter(e,context.ACTIVE_UNIFORMS);t<n;t++){let n=ProgramUniform.new(e,t);let o=n.name;let a="set"+Utility.uppercase(o);this[a]=function(t){n.set(t);return this};if(o in r){i[r[o]]=a}}let o=Utility.reverseMap(t.attributeMapping);let a=this.attributes=Object.create(null);for(let t=0,n=context.getProgramParameter(e,context.ACTIVE_ATTRIBUTES);t<n;t++){let n=context.getActiveAttrib(e,t);let r=n.name;if(r in o){a[o[r]]=ProgramAttribute.new(e,n)}}};t.setStandardUniforms=function(t){let e=this.standardParameterMapping;for(let n in t){if(n in e){this[e[n]](t[n])}}return this};let n=function(t,e,n){if(e in t.attributes){context.bindBuffer(context.ARRAY_BUFFER,n);t.attributes[e].bind()}return t};t.bindPositionAttribute=function(e){return n(this,t.POSITION_ATTRIBUTE,e)};t.bindNormalAttribute=function(e){return n(this,t.NORMAL_ATTRIBUTE,e)};t.bindTextureAttribute=function(e){return n(this,t.TEXTURE_ATTRIBUTE,e)};t.bindColorAttribute=function(e){return n(this,t.COLOR_ATTRIBUTE,e)};t.bindModelMatrixAttribute=function(e){return n(this,t.MODEL_MATRIX_ATTRIBUTE,e)};t.unbindAttributes=function(){for(let t in this.attributes){this.attributes[t].unbind()}};t.getCurrentProgram=function(){return e};t.use=function(){if(e!==this){if(e){e.unbindAttributes()}e=this;context.useProgram(this.program);this.currentShape=null}return this};t.useShape=function(t){if(this.currentShape!==t){this.currentShape=t;return true}return false};return t}();let ProgramUniform=function(){let t=Object.create(null);t.construct=function(t,e){let n=context.getActiveUniform(t,e);this.name=n.name;this.type=n.type;this.location=context.getUniformLocation(t,n.name);if(this.type===context.SAMPLER_2D){this.textureIndex="nextTextureIndex"in t?t.nextTextureIndex:0;t.nextTextureIndex=this.textureIndex+1}else{}return this};t.set=function(t){switch(this.type){case 5124:context.uniform1i(this.location,t);break;case 35667:context.uniform2iv(this.location,t);break;case 35668:context.uniform3iv(this.location,t);break;case 35669:context.uniform4iv(this.location,t);break;case 5126:context.uniform1f(this.location,t);break;case 35664:context.uniform2fv(this.location,t);break;case 35665:context.uniform3fv(this.location,t);break;case 35666:context.uniform4fv(this.location,t);break;case 35674:context.uniformMatrix2fv(this.location,false,t);break;case 35675:context.uniformMatrix3fv(this.location,false,t);break;case 35676:context.uniformMatrix4fv(this.location,false,t);break;case 35678:context.activeTexture(context.TEXTURE0+this.textureIndex);context.bindTexture(context.TEXTURE_2D,Texture.get(t).texture);context.uniform1i(this.location,this.textureIndex);break}};t.new=function(e,n){return Object.create(t).construct(e,n)};return t}();let ProgramAttribute=function(){let t=Object.create(null);t.construct=function(t,e){this.name=e.name;this.type=e.type;this.location=context.getAttribLocation(t,this.name);switch(this.type){case 5124:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,1,context.INT,false,0,0)};break;case 35667:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,2,context.INT,false,0,0)};break;case 35668:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,3,context.INT,false,0,0)};break;case 35669:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,4,context.INT,false,0,0)};break;case 5126:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,1,context.FLOAT,false,0,0)};break;case 35664:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,2,context.FLOAT,false,0,0)};break;case 35665:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,3,context.FLOAT,false,0,0)};break;case 35666:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,4,context.FLOAT,false,0,0)};break;case 35676:this.bind=function(){const t=16;const e=4*t;for(let n=0;n<4;++n){const r=this.location+n;const i=n*t;context.enableVertexAttribArray(r);context.vertexAttribPointer(r,4,context.FLOAT,false,e,i);context.vertexAttribDivisor(r,1)}};break}return this};t.unbind=function(){context.disableVertexAttribArray(this.location)};t.new=function(e,n){return Object.create(t).construct(e,n)};return t}();let Texture=function(){let t=ClassNamed(CLASS_NAME_REQUIRED);let e;t.construct=function(t){e=typeof e!=="undefined"&&e!=null?e:function(){return context.getExtension("EXT_texture_filter_anisotropic")}();t.anisotropicFiltering=Math.min(context.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT),"anisotropicFiltering"in t?t.anisotropicFiltering:4);if(typeof t.url==="undefined")throw"Texture URL Required";let n=this.texture=context.createTexture();let r=new Image;r.crossOrigin="anonymous";let i=this;r.onload=function(){context.bindTexture(context.TEXTURE_2D,n);context.texImage2D(context.TEXTURE_2D,0,context.RGBA,context.RGBA,context.UNSIGNED_BYTE,r);context.texParameteri(context.TEXTURE_2D,context.TEXTURE_MAG_FILTER,context.LINEAR);if("generateMipMap"in t&&t.generateMipMap===true){context.texParameteri(context.TEXTURE_2D,context.TEXTURE_MIN_FILTER,context.LINEAR_MIPMAP_LINEAR);context.texParameterf(context.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,t.anisotropicFiltering);context.generateMipmap(context.TEXTURE_2D)}else{context.texParameteri(context.TEXTURE_2D,context.TEXTURE_MIN_FILTER,context.LINEAR)}context.bindTexture(context.TEXTURE_2D,null);if(typeof t.onReady!=="undefined"){t.onReady.notify(i)}};r.src=t.url};return t}();let Node=function(){let t=ClassNamed(CLASS_NAME_GENERATED);t.construct=function(t){let e=1;let n=2;let r=4;let i=8;let o=0;if("transform"in t){this.transform=t.transform;o+=e}if("state"in t){this.state=t.state;o+=n}if("shape"in t){this.shape=Shape.get(t.shape);if(typeof this.shape==="undefined"){}this.instanceTransforms=this.shape.createInstanceTransforms(t.instance);o+=r}this.enabled=t.enabled=typeof t.enabled!=="undefined"&&t.enabled!=null?t.enabled:true;if(!("children"in t)||t.children!==false){this.children=[];o+=i}let a=function(t){return this};this.traverse=[a,a,a,a,function(t){if(this.enabled){this.draw(t)}return this},function(t){if(this.enabled){t.MODEL_MATRIX_PARAMETER=Float4x4.multiply(this.transform,t.MODEL_MATRIX_PARAMETER);this.draw(t)}return this},function(t){if(this.enabled){this.state(t);this.draw(t)}return this},function(t){if(this.enabled){this.state(t);t.MODEL_MATRIX_PARAMETER=Float4x4.multiply(this.transform,t.MODEL_MATRIX_PARAMETER);this.draw(t)}return this},function(t){if(this.enabled){let e=t.MODEL_MATRIX_PARAMETER;for(let n of this.children){t.MODEL_MATRIX_PARAMETER=e;n.traverse(t)}}return this},function(t){if(this.enabled){let e=Float4x4.multiply(this.transform,t.MODEL_MATRIX_PARAMETER);for(let n of this.children){t.MODEL_MATRIX_PARAMETER=e;n.traverse(t)}}return this},function(t){if(this.enabled){this.state(t);let e=t.MODEL_MATRIX_PARAMETER;for(let n of this.children){t.MODEL_MATRIX_PARAMETER=e;n.traverse(t)}}return this},function(t){if(this.enabled){this.state(t);let e=Float4x4.multiply(this.transform,t.MODEL_MATRIX_PARAMETER);for(let n of this.children){t.MODEL_MATRIX_PARAMETER=e;n.traverse(t)}}return this},function(t){if(this.enabled){let e=t.MODEL_MATRIX_PARAMETER;this.draw(t);for(let n of this.children){t.MODEL_MATRIX_PARAMETER=e;n.traverse(t)}}return this},function(t){if(this.enabled){let e=t.MODEL_MATRIX_PARAMETER=Float4x4.multiply(this.transform,t.MODEL_MATRIX_PARAMETER);this.draw(t);for(let n of this.children){t.MODEL_MATRIX_PARAMETER=e;n.traverse(t)}}return this},function(t){if(this.enabled){this.state(t);let e=t.MODEL_MATRIX_PARAMETER;this.draw(t);for(let n of this.children){t.MODEL_MATRIX_PARAMETER=e;n.traverse(t)}}return this},function(t){if(this.enabled){this.state(t);let e=t.MODEL_MATRIX_PARAMETER=Float4x4.multiply(this.transform,t.MODEL_MATRIX_PARAMETER);this.draw(t);for(let n of this.children){t.MODEL_MATRIX_PARAMETER=e;n.traverse(t)}}return this}][o];return this};t.addChild=function(t){if("children"in this){this.children.push(t);t.parent=this}else{}return this};t.draw=function(t){Program.getCurrentProgram().setStandardUniforms(t);this.shape.instanceTransforms=this.instanceTransforms;this.shape.draw()};t.traverse=function(t){return this};t.getTransform=function(t){let e="transform"in this?this.transform:Float4x4.IDENTITY;if(typeof t!=="undefined"&&this==t||!("parent"in this)){return e}else{return Float4x4.multiply(e,this.parent.getTransform(t))}};return t}();let Cloud=function(){let t=Object.create(Node);t.construct=function(e){Object.getPrototypeOf(t).construct.call(this,e);this.pointShape="pointShape"in e?e.pointShape:"sphere2";this.pointSize="pointSize"in e?e.pointSize:.02;return this};t.addPoint=function(t){let e=Float4x4.multiply(Float4x4.scale(this.pointSize),Float4x4.translate(t));this.addChild(Node.new({transform:e,shape:this.pointShape,children:false}));return this};t.addPoints=function(t){for(let e of t){this.addPoint(e)}return this};t.new=function(e){e.children=true;return Object.create(t).construct(e)};return t}();let Shape=function(){let t=ClassNamed(CLASS_NAME_REQUIRED);t.construct=function(t){let e=t.buffers();let n=function(t,e,n){let r=context.createBuffer();context.bindBuffer(t,r);context.bufferData(t,e,context.STATIC_DRAW);r.itemSize=n;r.numItems=e.length/n;return r};const r=1;const i=2;const o=4;const a=8;let s=0;if("position"in e){this.positionBuffer=n(context.ARRAY_BUFFER,new Float32Array(e.position),3)}else{}if("normal"in e){this.normalBuffer=n(context.ARRAY_BUFFER,new Float32Array(e.normal),3);s+=r}if("texture"in e){this.textureBuffer=n(context.ARRAY_BUFFER,new Float32Array(e.texture),2);s+=i}if("index"in e){this.indexBuffer=n(context.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.index),1);s+=o}if("color"in e){this.colorBuffer=n(context.ARRAY_BUFFER,new Float32Array(e.color),4);s+=a}this.draw=[function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindTextureAttribute(this.textureBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindTextureAttribute(this.textureBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindTextureAttribute(this.textureBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindTextureAttribute(this.textureBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindTextureAttribute(this.textureBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindTextureAttribute(this.textureBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindTextureAttribute(this.textureBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindTextureAttribute(this.textureBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}}][s];return this};t.createInstanceTransforms=function(t){const e=4;const n=16;if(typeof t==="undefined"){t=1}if(typeof t==="number"||t.length===0){let e=[];for(let n=0,r=Math.max(1,t);n<r;++n){e.push(Float4x4.IDENTITY)}t=e}let r=t.length;let i={count:r,data:new Float32Array(r*n),matrices:[],buffer:function(){let t=context.createBuffer();context.bindBuffer(context.ARRAY_BUFFER,t);context.bufferData(context.ARRAY_BUFFER,r*n*e,context.DYNAMIC_DRAW);return t}()};for(let o=0;o<r;++o){const r=o*n*e;let a=new Float32Array(i.data.buffer,r,n);i.matrices.push(a);Float4x4.copy(t[o],a)}return i};return t}();let Thing=function(){let t=ClassNamed(CLASS_NAME_GENERATED);t.construct=function(t){this.node=t.node;this.update=t.update};t.updateAll=function(e){t.forEach(function(t){t.update(e)})};return t}();let TextFile=function(){let t=ClassNamed(CLASS_NAME_REQUIRED);t.construct=function(t){if(typeof t.url==="undefined")throw"TextFile URL Required";let e=this;let n=new XMLHttpRequest;n.onload=function(r){if(n.status===200){e.text=n.responseText}if(typeof t.onReady!=="undefined"){t.onReady.notify(e)}};n.open("GET",t.url);n.send()};return t}();let ShapeBuilder=function(){let t=Object.create(null);t.construct=function(t){this.precision=t=typeof t!=="undefined"&&t!=null?t:7;this.vertexIndex=Object.create(null);this.vertices=[];this.faces=[];this.normals=[];this.texture=[];return this};t.addVertex=function(t){let e=Float3.str(t);if(e in this.vertexIndex){return this.vertexIndex[e]}else{let n=this.vertices.length;this.vertices.push(t);this.vertexIndex[e]=n;return n}};t.addVertexNormal=function(t,e){let n=Float3.str(t)+Float3.str(e);if(n in this.vertexIndex){return this.vertexIndex[n]}else{let r=this.vertices.length;this.vertices.push(t);this.normals.push(e);this.vertexIndex[n]=r;return r}};t.addVertexTexture=function(t,e){let n=Float3.str(t)+Float2.str(e);if(n in this.vertexIndex){return this.vertexIndex[n]}else{let r=this.vertices.length;this.vertices.push(t);this.texture.push(e);this.vertexIndex[n]=r;return r}};t.addVertexNormalTexture=function(t,e,n){let r=Float3.str(t)+Float3.str(e)+Float2.str(n);if(r in this.vertexIndex){return this.vertexIndex[r]}else{let i=this.vertices.length;this.vertices.push(t);this.normals.push(e);this.texture.push(n);this.vertexIndex[r]=i;return i}};t.addFace=function(t){this.faces.push(t)};t.makeBuffers=function(){let t={position:Utility.flatten(this.vertices),index:Utility.flatten(this.faces)};if(this.normals.length>0){t.normal=Utility.flatten(this.normals)}if(this.texture.length>0){t.texture=Utility.flatten(this.texture)}return t};t.makeFacets=function(){let t=[];let e=[];for(let n of this.faces){let r=this.vertices[n[0]];let i=this.vertices[n[1]];let o=this.vertices[n[2]];let a=Float3.normalize(Float3.subtract(i,r));let s=Float3.normalize(Float3.subtract(o,i));let u=Float3.cross(a,s);for(let r=0;r<n.length;++r){t.push(this.vertices[n[r]]);e.push(u)}}return{position:Utility.flatten(t),normal:Utility.flatten(e)}};t.new=function(t){return Object.create(ShapeBuilder).construct(t)};return t}();let Primitive=function(){let t=Object.create(null);t.getShapeBuilder=function(){};t.makeFromBuilder=function(t,e){t=typeof t!=="undefined"&&t!=null?t:this.name;return Shape.new({buffers:function(){return e.makeFacets()}},t)};t.make=function(t){let e=this.getShapeBuilder();return this.makeFromBuilder(t,e)};return t}();let Tetrahedron=function(){let t=Object.create(Primitive);t.name="tetrahedron";t.getShapeBuilder=function(){let t=ShapeBuilder.new();t.addVertex([1,1,1]);t.addVertex([-1,1,-1]);t.addVertex([-1,-1,1]);t.addVertex([1,-1,-1]);t.addFace([0,1,2]);t.addFace([1,3,2]);t.addFace([2,3,0]);t.addFace([3,1,0]);return t};return t}();let Hexahedron=function(){let t=Object.create(Primitive);t.name="cube";t.getShapeBuilder=function(){let t=ShapeBuilder.new();t.addVertex([-1,-1,-1]);t.addVertex([-1,1,-1]);t.addVertex([1,1,-1]);t.addVertex([1,-1,-1]);t.addVertex([-1,-1,1]);t.addVertex([-1,1,1]);t.addVertex([1,1,1]);t.addVertex([1,-1,1]);t.addFace([0,1,2,0,2,3]);t.addFace([7,6,5,7,5,4]);t.addFace([1,5,6,1,6,2]);t.addFace([4,0,3,4,3,7]);t.addFace([4,5,1,4,1,0]);t.addFace([3,2,6,3,6,7]);return t};return t}();let Octahedron=function(){let t=Object.create(Primitive);t.name="octahedron";t.getShapeBuilder=function(){let t=ShapeBuilder.new();t.addVertex([0,1,0]);t.addVertex([1,0,0]);t.addVertex([0,0,1]);t.addVertex([-1,0,0]);t.addVertex([0,0,-1]);t.addVertex([0,-1,0]);t.addFace([0,2,1]);t.addFace([0,3,2]);t.addFace([0,4,3]);t.addFace([0,1,4]);t.addFace([5,1,2]);t.addFace([5,2,3]);t.addFace([5,3,4]);t.addFace([5,4,1]);return t};return t}();let Icosahedron=function(){let t=Object.create(Primitive);t.name="icosahedron";t.getShapeBuilder=function(){let t=ShapeBuilder.new();let e=(1+Math.sqrt(5))/2;let n=1/e;e=1;t.addVertex([-n,e,0]);t.addVertex([n,e,0]);t.addVertex([-n,-e,0]);t.addVertex([n,-e,0]);t.addVertex([0,-n,e]);t.addVertex([0,n,e]);t.addVertex([0,-n,-e]);t.addVertex([0,n,-e]);t.addVertex([e,0,-n]);t.addVertex([e,0,n]);t.addVertex([-e,0,-n]);t.addVertex([-e,0,n]);t.addFace([0,11,5]);t.addFace([0,5,1]);t.addFace([0,1,7]);t.addFace([0,7,10]);t.addFace([0,10,11]);t.addFace([1,5,9]);t.addFace([5,11,4]);t.addFace([11,10,2]);t.addFace([10,7,6]);t.addFace([7,1,8]);t.addFace([3,9,4]);t.addFace([3,4,2]);t.addFace([3,2,6]);t.addFace([3,6,8]);t.addFace([3,8,9]);t.addFace([4,9,5]);t.addFace([2,4,11]);t.addFace([6,2,10]);t.addFace([8,6,7]);t.addFace([9,8,1]);return t};return t}();let Square=function(){let t=Object.create(Primitive);t.name="square";t.makeFromBuilder=function(t,e){t=typeof t!=="undefined"&&t!=null?t:this.name;return Shape.new({buffers:function(){return e.makeBuffers()}},t)};t.getShapeBuilder=function(){let t=ShapeBuilder.new();t.addVertexNormalTexture([1,1,0],[0,0,1],[1,0]);t.addVertexNormalTexture([-1,1,0],[0,0,1],[0,0]);t.addVertexNormalTexture([-1,-1,0],[0,0,1],[0,1]);t.addVertexNormalTexture([1,-1,0],[0,0,1],[1,1]);t.addFace([0,1,2,0,2,3]);return t};return t}();let Sphere=function(){let t=Object.create(Primitive);t.name="sphere";t.parameters={baseShapeBuilderType:Icosahedron,subdivisions:4};t.getShapeBuilder=function(){let t=ShapeBuilder.new();let e=function(e){return t.addVertex(Float3.normalize(e))};let n=this.parameters.baseShapeBuilderType.getShapeBuilder();for(let t of n.vertices){e(t)}let r=t.vertices;let i=t.faces=n.faces;let o=function(){let n=i.splice(0,1)[0];let o=e(Float3.add(r[n[0]],r[n[1]]));let a=e(Float3.add(r[n[1]],r[n[2]]));let s=e(Float3.add(r[n[2]],r[n[0]]));t.addFace([n[0],o,s]);t.addFace([n[1],a,o]);t.addFace([n[2],s,a]);t.addFace([o,a,s])};for(let t=0;t<this.parameters.subdivisions;++t){for(let t=0,e=i.length;t<e;++t){o()}}return t};t.makeFromBuilder=function(t,e){t=typeof t!=="undefined"&&t!=null?t:this.name;return Shape.new({buffers:function(){let t=e.makeBuffers();t.normal=t.position;return t}},t)};t.makeN=function(t){this.parameters.subdivisions=t;this.make(this.name+t)};return t}();let makeNormal=function(t){let e=t.length-1;let n=[];let r=function(t,e){let r=Float2.subtract(t,e);let i=Float2.perpendicular(r);n.push(Float2.normalize(i))};if(Float2.equals(t[0],t[e])){for(let n=0;n<=e;++n){let i=t[(n-1+e)%e];let o=t[(n+1)%e];r(i,o)}}else{for(let n=0;n<=e;++n){let i=t[n===0?n:n-1];let o=t[n===e?n:n+1];r(i,o)}}return n};let makeRevolve=function(t,e,n,r,i){let o=1e-6;let a=e.length-1;n=typeof n!=="undefined"&&n!=null?n:makeNormal(e);i=typeof i!=="undefined"&&i!=null?i:function(t){return t};return Shape.new({buffers:function(){let t=ShapeBuilder.new();let s=-2*Math.PI/r;for(let u=0;u<r;++u){let c=u+1;let l=u*s,f=Math.cos(l),d=Math.sin(l);let h=c%r*s,x=Math.cos(h),m=Math.sin(h);for(let s=0;s<a;++s){let l=s+1;let h=e[s],A=n[s];let b=e[l],T=n[l];if(Float2.norm(Float2.subtract(h,b))>o){let e=(h[0]<o?0:2)+(b[0]<o?0:1);switch(e){case 0:break;case 1:{let e=t.addVertexNormalTexture([0,h[1],0],[A[0]*f,A[1],A[0]*d],[u/r,i(s/a)]);let n=t.addVertexNormalTexture([b[0]*f,b[1],b[0]*d],[T[0]*f,T[1],T[0]*d],[u/r,i(l/a)]);let o=t.addVertexNormalTexture([b[0]*x,b[1],b[0]*m],[T[0]*x,T[1],T[0]*m],[c/r,i(l/a)]);t.addFace([e,n,o]);break}case 2:{let e=t.addVertexNormalTexture([h[0]*f,h[1],h[0]*d],[A[0]*f,A[1],A[0]*d],[u/r,i(s/a)]);let n=t.addVertexNormalTexture([h[0]*x,h[1],h[0]*m],[A[0]*x,A[1],A[0]*m],[c/r,i(s/a)]);let o=t.addVertexNormalTexture([0,b[1],0],[T[0]*f,T[1],T[0]*d],[u/r,i(l/a)]);t.addFace([e,o,n]);break}case 3:{let e=t.addVertexNormalTexture([h[0]*f,h[1],h[0]*d],[A[0]*f,A[1],A[0]*d],[u/r,i(s/a)]);let n=t.addVertexNormalTexture([b[0]*f,b[1],b[0]*d],[T[0]*f,T[1],T[0]*d],[u/r,i(l/a)]);let o=t.addVertexNormalTexture([h[0]*x,h[1],h[0]*m],[A[0]*x,A[1],A[0]*m],[c/r,i(s/a)]);let R=t.addVertexNormalTexture([b[0]*x,b[1],b[0]*m],[T[0]*x,T[1],T[0]*m],[c/r,i(l/a)]);t.addFace([o,e,R,R,e,n]);break}}}}}return t.makeBuffers()}},t)};let makeBall=function(t,e){let n=[];let r=[];let i=Math.PI/e;for(let t=0;t<=e;++t){let e=i*t;let o=Float2.fixNum([Math.sin(e),Math.cos(e)]);n.push(o);r.push(o)}return makeRevolve(t,n,r,e*2)};let makeSimpleExtrude=function(t,e,n,r,i){n=typeof n!=="undefined"&&n!=null?n:2;r=typeof r!=="undefined"&&r!=null?r:makeNormal(e);return Shape.new({buffers:function(){let t=ShapeBuilder.new();let i=1e-6;let o=n/2;let a=e.length-1;for(let n=0;n<a;++n){let s=n+1;let u=e[n],c=r[n];let l=e[s],f=r[s];if(Float2.norm(Float2.subtract(u,l))>i){let e=t.addVertexNormalTexture([u[0],u[1],-o],[c[0],c[1],0],[0,n/a]);let r=t.addVertexNormalTexture([u[0],u[1],o],[c[0],c[1],0],[1,n/a]);let i=t.addVertexNormalTexture([l[0],l[1],-o],[f[0],f[1],0],[0,s/a]);let d=t.addVertexNormalTexture([l[0],l[1],o],[f[0],f[1],0],[1,s/a]);t.addFace([e,r,d,i,e,d])}}return t.makeBuffers()}},t)};