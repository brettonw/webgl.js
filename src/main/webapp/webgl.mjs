export let LogLevel=function(){let e=Object.create(null);e.TRACE=0;e.INFO=1;e.WARNNG=2;e.ERROR=3;let n=e.ERROR;e.set=function(t){n=t};let r=["TRC","INF","WRN","ERR"];e.say=function(t,e){if(t>=n){console.log(r[t]+": "+e)}};e.trace=function(t){this.say(e.TRACE,t)};e.info=function(t){this.say(e.INFO,t)};e.warn=function(t){this.say(e.WARNNG,t)};e.error=function(t){this.say(e.ERROR,t)};return e}();export let Utility=function(){let e=Object.create(null);const n=Math.PI*2;let r=e.unwind=function(t,e){t-=Math.floor(t/e)*e;while(t>=e){t-=e}while(t<0){t+=e}return t};e.unwindRadians=function(t){return e.unwind(t,n)};e.unwindDegrees=function(t){return e.unwind(t,360)};e.degreesToRadians=function(t){return r(t/180,2)*Math.PI};e.cos=function(t){return Math.cos(e.degreesToRadians(t))};e.sin=function(t){return Math.sin(e.degreesToRadians(t))};e.tan=function(t){return Math.tan(e.degreesToRadians(t))};e.radiansToDegrees=function(t){return r(t,n)/Math.PI*180};e.uppercase=function(t){return t[0].toUpperCase()+t.slice(1)};e.lowercase=function(t){return t[0].toLowerCase()+t.slice(1)};e.flatten=function(t){let n=[];for(let e of t){for(let t of e){n.push(t)}}return n};e.fixNum=function(t,e){e=typeof e!=="undefined"&&e!=null?e:7;return Number.parseFloat(t.toFixed(e))};e.padNum=function(t,e,n){n=n||"0";t=t+"";return t.length>=e?t:new Array(e-t.length+1).join(n)+t};e.defaultValue=function(t,e){return t=typeof t!=="undefined"&&t!=null?t:e};e.defaultFunction=function(t,e){return t=typeof t!=="undefined"&&t!=null?t:e()};e.reverseMap=function(e){let n=Object.create(null);for(let t in e){n[e[t]]=t}return n};return e}();export let ClassBase=function(){let t=Object.create(null);t.new=function(t){let e=Object.create(this);if("construct"in e){t=typeof t!=="undefined"&&t!=null?t:Object.create(null);e.construct(t)}return e};return t}();export const CLASS_NAME_REQUIRED="CLASS_NAME_REQUIRED";export const CLASS_NAME_GENERATED="CLASS_NAME_GENERATED";export const CLASS_NAME_OPTIONAL="CLASS_NAME_OPTIONAL";export let ClassNamed=function(e){e=typeof e!=="undefined"&&e!=null?e:CLASS_NAME_OPTIONAL;let r=Object.create(ClassBase);let i=Object.create(null);let n=0;let o=function(t){if(typeof t!=="undefined"&&t!=null){if(!(t in i)){return t}throw"Duplicate name ("+t+")"}switch(e){case CLASS_NAME_REQUIRED:throw"Name is required";case CLASS_NAME_GENERATED:return"id"+Utility.padNum(++n,5);case CLASS_NAME_OPTIONAL:return null}};r.new=function(t,e){t=typeof t!=="undefined"&&t!=null?t:Object.create(null);if((e=o(e))!=null)t.name=e;let n=Object.getPrototypeOf(r).new.call(this,t);if(e!=null){n.name=e;i[e]=n}return n};r.get=function(t){return i[t]};r.getName=function(){return"name"in this?this.name:"node"};r.getIndex=function(){return i};r.forEach=function(n){for(let e in i){let t=i[e];n(t)}};return r};export let OnReady=function(){let n=Object.create(null);n.construct=function(t,e){this.scope=t;this.callback=e;return this};n.notify=function(t){this.callback.call(this.scope,t)};n.new=function(t,e){return Object.create(n).construct(t,e)};return n}();export let MouseTracker=function(){let r=Object.create(null);let i;let o;let a;let s;let u=function(t){t.stopPropagation();t.preventDefault();return false};let c=function(t){return[(t.clientX-o.left)/o.width,(t.clientY-o.top)/o.height,0]};let l=function(t){return[0,0,(t.clientY-o.top)/o.height]};let e=function(t){let e=c(t);let n=Float3.subtract(e,i);if(Float3.normSq(n)>0){i=e;a.notify(n)}return u(t)};let n=function(t){let e=l(t);let n=Float3.subtract(e,i);if(Float3.normSq(n)>0){i=e;a.notify(n)}return u(t)};let f=function(t){window.removeEventListener("pointermove",e,false);window.removeEventListener("pointerup",f,false);return u(t)};let d=function(t){window.removeEventListener("pointermove",n,false);window.removeEventListener("pointerup",d,false);return u(t)};let h=function(t){switch(t.buttons){case 1:switch(t.button){case 0:i=c(t);window.addEventListener("pointermove",e,false);window.addEventListener("pointerup",f,false);break;case 1:break}break;case 2:i=l(t);window.addEventListener("pointermove",n,false);window.addEventListener("pointerup",d,false);break}return u(t)};let x=function(t){a.notify(Float3.copy([0,0,t.deltaY]));return u(t)};const m=37;const A=38;const b=39;const p=40;let T=function(t){switch(t.keyCode){case m:a.notify([-s,0,0]);break;case A:a.notify([0,s,0]);break;case b:a.notify([s,0,0]);break;case p:a.notify([0,-s,0]);break;default:a.notify([0,0,0]);break}};r.construct=function(t,e,n){a=e;s=n=typeof n!=="undefined"&&n!=null?n:.05;let r=document.getElementById(t);o=r.getBoundingClientRect();r.addEventListener("pointerdown",h,false);r.addEventListener("keydown",T,true);r.addEventListener("contextmenu",u,false);r.addEventListener("wheel",x,false);r.focus()};r.new=function(t,e,n){return Object.create(r).construct(t,e,n)};return r}();let DocumentHelper=function(){let t=Object.create(ClassBase);t.element=function(t){this[t]=document.getElementById(t);return this};t.elements=function(...e){for(let t of e){this.element(t)}return this};t.all=function(){return this};return t}();export let RollingStats=function(){let t=Object.create(ClassBase);t.construct=function(t){this.count=Utility.defaultValue(t.count,10);if("fill"in t){this.fill=t.fill}this.reset()};t.update=function(t){this.sum+=t;if(this.history.length<this.count){this.history.push(t)}else{this.sum-=this.history[this.current];this.history[this.current]=t;this.current=(this.current+1)%this.count}let n=this.sum/this.history.length;let r=Number.POSITIVE_INFINITY;let i=Number.NEGATIVE_INFINITY;let o=0;for(let e of this.history){i=Math.max(e,i);r=Math.min(e,r);let t=e-n;o+=t*t}o/=this.count;return{min:r,max:i,avg:n,var:o,std:Math.sqrt(o)}};t.reset=function(){this.history=[];this.sum=0;if("fill"in this){for(let t=0;t<this.count;++t){this.history.push(this.fill);this.sum+=this.fill}}this.current=0};return t}();let FloatN=function(dim){let _=Object.create(null);_.create=function(){return new Float32Array(dim)};eval(function(){let e="_.copy = function (from, to) {\n";e+="to = (typeof to !== 'undefined') ? to : _.create ();\n";for(let t=0;t<dim;++t){e+="to["+t+"] = from["+t+"];\n"}e+="return to;\n";e+="};\n";return e}());eval(function(){let e="_.point = function (from, to) {\n";e+="to = (typeof to !== 'undefined') ? to : _.create ();\n";let n=dim-1;for(let t=0;t<n;++t){e+="to["+t+"] = from["+t+"];\n"}e+="to["+n+"] = 1;\n";e+="return to;\n";e+="};\n";return e}());eval(function(){let e="_.vector = function (from, to) {\n";e+="to = (typeof to !== 'undefined') ? to : _.create ();\n";let n=dim-1;for(let t=0;t<n;++t){e+="to["+t+"] = from["+t+"];\n"}e+="to["+n+"] = 0;\n";e+="return to;\n";e+="};\n";return e}());eval(function(){let e="_.dot = function (left, right) {\n";e+="return (left[0] * right[0])";for(let t=1;t<dim;++t){e+="\n + (left["+t+"] * right["+t+"])"}e+=";\n";e+="};\n";return e}());_.normSq=function(t){return _.dot(t,t)};_.norm=function(t){let e=_.normSq(t);return e>0?Math.abs(e-1)>1e-6?Math.sqrt(e):1:0};_.normalize=function(t,e){let n=_.norm(t);return Math.abs(n-1)>1e-6?_.scale(t,1/n,e):_.copy(t,e)};eval(function(){let e="_.add = function (left, right, to) {\n";e+="to = (typeof to !== 'undefined') ? to : _.create ();\n";for(let t=0;t<dim;++t){e+="to["+t+"] = left["+t+"] + right["+t+"];\n"}e+="return to;\n";e+="};\n";return e}());eval(function(){let e="_.subtract = function (left, right, to) {\n";e+="to = (typeof to !== 'undefined') ? to : _.create ();\n";for(let t=0;t<dim;++t){e+="to["+t+"] = left["+t+"] - right["+t+"];\n"}e+="return to;\n";e+="};\n";return e}());eval(function(){let e="_.scale = function (from, scale, to) {\n";e+="to = (typeof to !== 'undefined') ? to : _.create ();\n";for(let t=0;t<dim;++t){e+="to["+t+"] = from["+t+"] * scale;\n"}e+="return to;\n";e+="};\n";return e}());eval(function(){let e="_.fixNum = function (from, precision, to) {\n";e+="to = (typeof to !== 'undefined') ? to : _.create ();\n";for(let t=0;t<dim;++t){e+="to["+t+"] = Utility.fixNum (from["+t+"], precision);\n"}e+="return to;\n";e+="};\n";return e}());eval(function(){let e="_.minor = function (from) {\n";e+="let minorIndex = 0, minorValue = from[minorIndex];\n";for(let t=1;t<dim;++t){e+="nextValue = from["+t+"]; ";e+="if (minorValue > nextValue) { minorIndex = "+t+"; minorValue = nextValue;};\n"}e+="return minorIndex;\n";e+="};\n";return e}());eval(function(){let e="_.major = function (from) {\n";e+="let majorIndex = 0, majorValue = from[majorIndex];\n";for(let t=1;t<dim;++t){e+="nextValue = from["+t+"]; ";e+="if (majorValue < nextValue) { majorIndex = "+t+"; majorValue = nextValue;};\n"}e+="return majorIndex;\n";e+="};\n";return e}());eval(function(){let e="_.str = function (from) {\n";e+="return '(' + from[0]";for(let t=1;t<dim;++t){e+="\n + ', ' +  + from["+t+"].toFixed (7)"}e+=" + ')';\n";e+="};\n";return e}());_.equals=function(t,e){return _.str(t)===_.str(e)};return _};export let Float2=function(){let n=FloatN(2);n.perpendicular=function(t,e){e=e=typeof e!=="undefined"&&e!=null?e:n.create();e[0]=t[1];e[1]=-t[0];return e};n.cross=function(t,e){return t[0]*e[1]-t[1]*e[0]};return n}();export let Float3=function(){let r=FloatN(3);r.cross=function(t,e,n){n=n=typeof n!=="undefined"&&n!=null?n:r.create();n[0]=t[1]*e[2]-t[2]*e[1];n[1]=t[2]*e[0]-t[0]*e[2];n[2]=t[0]*e[1]-t[1]*e[0];return n};return r}();export let Float4=function(){return FloatN(4)}();let FloatNxN=function(dim){let _=Object.create(null);let _FloatN=FloatN(dim);let size=dim*dim;let index=_.index=function(t,e){return t*dim+e};let defineTo=function(t){t=typeof t!=="undefined"&&t!=null?t:"to";return t+" = (typeof "+t+" !== 'undefined') ? "+t+" : _.create ();\n"};_.create=function(){return new Float32Array(size)};eval(function(){let r="_.copy = function (from, to) {\n";r+=defineTo();for(let n=0;n<dim;++n){for(let e=0;e<dim;++e){let t=index(n,e);r+="to["+t+"] = from["+t+"]; "}r+="\n"}r+="return to;\n";r+="};\n";return r}());eval(function(){let n="_.identity = function (to) {\n";n+=defineTo();for(let e=0;e<dim;++e){for(let t=0;t<dim;++t){n+="to["+index(e,t)+"] = "+(e===t?1:0)+"; "}n+="\n"}n+="return to;\n";n+="};\n";return n}());_.IDENTITY=_.identity();eval(function(){let n="_.transpose = function (from, to) {\n";n+=defineTo();for(let e=0;e<dim;++e){for(let t=0;t<dim;++t){n+="to["+index(e,t)+"] = from["+index(t,e)+"]; "}n+="\n"}n+="return to;\n";n+="};\n";return n}());eval(function(){let n=function(e,n){let r="(left["+index(e,0)+"] * right["+index(0,n)+"])";for(let t=1;t<dim;++t){r+=" + (left["+index(e,t)+"] * right["+index(t,n)+"])"}r+=";\n";return r};let r="_.multiply = function (left, right, to) {\n";r+=defineTo();for(let e=0;e<dim;++e){for(let t=0;t<dim;++t){r+="to["+index(e,t)+"] = "+n(e,t)}}r+="return to;\n";r+="};\n";return r}());_.chain=function(...n){let r=n[0];for(let e=1,t=n.length;e<t;++e){let t=n[e];r=_.multiply(r,t)}return r};eval(function(){let e=dim-1;let n="_.scale = function (scale, to) {\n";n+="scale = Array.isArray(scale) ? scale : Array("+e+").fill(scale);\n";n+="to = _.identity (to);\n";for(let t=0;t<e;++t){n+="to["+index(t,t)+"] = scale["+t+"]; "}n+="\n";n+="return to;\n";n+="};\n";return n}());eval(function(){let e=dim-1;let n="_.translate = function (translate, to) {\n";n+="to = _.identity (to);\n";for(let t=0;t<e;++t){n+="to["+index(e,t)+"] = translate["+t+"]; "}n+="\n";n+="return to;\n";n+="};\n";return n}());eval(function(){let e=function(e){let n="'(' + from["+index(e,0)+"]";for(let t=1;t<dim;++t){n+=" + ', ' + from["+index(e,t)+"]"}n+=" + ')'";return n};let n="_.str = function (from) {\n";n+="return ";n+=e(0);for(let t=1;t<dim;++t){n+=" + ', ' + "+e(t)}n+=";\n";n+="};\n";return n}());return _};export let Float4x4=function(){let t=4;let m=FloatNxN(t);m.inverse=function(t,e){e=e=typeof e!=="undefined"&&e!=null?e:m.create();let n=t[0]*t[5]-t[1]*t[4],r=t[0]*t[6]-t[2]*t[4],i=t[9]*t[14]-t[10]*t[13],o=t[9]*t[15]-t[11]*t[13],a=t[10]*t[15]-t[11]*t[14],s=t[0]*t[7]-t[3]*t[4],u=t[1]*t[6]-t[2]*t[5],c=t[1]*t[7]-t[3]*t[5],l=t[2]*t[7]-t[3]*t[6],f=t[8]*t[13]-t[9]*t[12],d=t[8]*t[14]-t[10]*t[12],h=t[8]*t[15]-t[11]*t[12],x=1/(n*a-r*o+s*i+u*h-c*d+l*f);e[0]=(t[5]*a-t[6]*o+t[7]*i)*x;e[1]=(-t[1]*a+t[2]*o-t[3]*i)*x;e[2]=(t[13]*l-t[14]*c+t[15]*u)*x;e[3]=(-t[9]*l+t[10]*c-t[11]*u)*x;e[4]=(-t[4]*a+t[6]*h-t[7]*d)*x;e[5]=(t[0]*a-t[2]*h+t[3]*d)*x;e[6]=(-t[12]*l+t[14]*s-t[15]*r)*x;e[7]=(t[8]*l-t[10]*s+t[11]*r)*x;e[8]=(t[4]*o-t[5]*h+t[7]*f)*x;e[9]=(-t[0]*o+t[1]*h-t[3]*f)*x;e[10]=(t[12]*c-t[13]*s+t[15]*n)*x;e[11]=(-t[8]*c+t[9]*s-t[11]*n)*x;e[12]=(-t[4]*i+t[5]*d-t[6]*f)*x;e[13]=(t[0]*i-t[1]*d+t[2]*f)*x;e[14]=(-t[12]*u+t[13]*r-t[14]*n)*x;e[15]=(t[8]*u-t[9]*r+t[10]*n)*x;return e};m.preMultiply=function(t,e,n){n=n=typeof n!=="undefined"&&n!=null?n:Float4.create();let r=t[0],i=t[1],o=t[2],a=t[3];n[0]=e[0]*r+e[4]*i+e[8]*o+e[12]*a;n[1]=e[1]*r+e[5]*i+e[9]*o+e[13]*a;n[2]=e[2]*r+e[6]*i+e[10]*o+e[14]*a;n[3]=e[3]*r+e[7]*i+e[11]*o+e[15]*a;return n};m.postMultiply=function(t,e,n){n=n=typeof n!=="undefined"&&n!=null?n:Float4.create();let r=e[0],i=e[1],o=e[2],a=e[3];n[0]=t[0]*r+t[1]*i+t[2]*o+t[3]*a;n[1]=t[4]*r+t[5]*i+t[6]*o+t[7]*a;n[2]=t[8]*r+t[9]*i+t[10]*o+t[11]*a;n[3]=t[12]*r+t[13]*i+t[14]*o+t[15]*a;return n};m.rotateX=function(t){let e=m.identity();e[5]=e[10]=Math.cos(t);e[9]=-(e[6]=Math.sin(t));return e};m.rotateY=function(t){let e=m.identity();e[0]=e[10]=Math.cos(t);e[2]=-(e[8]=Math.sin(t));return e};m.rotateZ=function(t){let e=m.identity();e[0]=e[5]=Math.cos(t);e[4]=-(e[1]=Math.sin(t));return e};let s=function(t,e,n,r,i,o,a){a=a=typeof a!=="undefined"&&a!=null?a:m.create();let s=e-t,u=r-n,c=o-i;a[0]=i*2/s;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=i*2/u;a[6]=0;a[7]=0;a[8]=(e+t)/s;a[9]=(r+n)/u;a[10]=-(o+i)/c;a[11]=-1;a[12]=0;a[13]=0;a[14]=-2*o*i/c;a[15]=0;return a};m.frustum=s;m.perspective=function(t,e,n,r,i){let o=n*Math.tan(Utility.degreesToRadians(t*.5));let a=o*e;return s(-a,a,-o,o,n,r,i)};m.orthographic=function(t,e,n,r,i,o,a){a=a=typeof a!=="undefined"&&a!=null?a:m.create();let s=e-t,u=r-n,c=o-i;a[0]=2/s;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2/u;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=-2/c;a[11]=0;a[12]=-(t+e)/s;a[13]=-(r+n)/u;a[14]=-(o+i)/c;a[15]=1;return a};let a=function(t,e,n,r){let i=m.create();i[0]=t[0];i[1]=t[1];i[2]=t[2];i[3]=0;i[4]=e[0];i[5]=e[1];i[6]=e[2];i[7]=0;i[8]=n[0];i[9]=n[1];i[10]=n[2];i[11]=0;i[12]=r[0];i[13]=r[1];i[14]=r[2];i[15]=1;return m.inverse(i)};m.viewMatrix=a;let u=function(t,e,n){n=Float3.normalize(Utility.defaultValue(n,[0,1,0]));let r=Float3.normalize(e);let i=Float3.normalize(Float3.cross(n,r));let o=Float3.normalize(Float3.cross(r,i));return a(i,o,r,t)};m.lookFrom=u;m.lookFromAt=function(t,e,n){return u(t,Float3.subtract(t,e),n)};m.lookAt=function(t,e,n,r,i){let o=t/Math.tan(Utility.degreesToRadians(e*.5));let a=Float3.add(r,Float3.scale(n,o/Float3.norm(n)));return u(a,n,i)};m.rotateZAxisTo=function(t,e){e=Utility.defaultFunction(e,function(){return[0,1,0]});t=Float3.normalize(t);let n=Float3.normalize(Float3.cross(e,t));let r=Float3.normalize(Float3.cross(t,n));let i=m.create();i[0]=n[0];i[1]=n[1];i[2]=n[2];i[3]=0;i[4]=r[0];i[5]=r[1];i[6]=r[2];i[7]=0;i[8]=t[0];i[9]=t[1];i[10]=t[2];i[11]=0;i[12]=0;i[13]=0;i[14]=0;i[15]=1;return i};m.rotateXAxisTo=function(t,e){e=Utility.defaultFunction(e,function(){return[0,1,0]});t=Float3.normalize(t);let n=Float3.normalize(Float3.cross(t,e));let r=Float3.normalize(Float3.cross(n,t));let i=m.create();i[0]=t[0];i[1]=t[1];i[2]=t[2];i[3]=0;i[4]=r[0];i[5]=r[1];i[6]=r[2];i[7]=0;i[8]=n[0];i[9]=n[1];i[10]=n[2];i[11]=0;i[12]=0;i[13]=0;i[14]=0;i[15]=1;return i};return m}();let context;export let Context=function(){let t=Object.create(null);t.get=function(){return context};return t}();export let Render=function(){let t=Object.create(ClassBase);t.construct=function(e){let t=document.getElementById(e.canvasDivId);let n=document.createElement("canvas");t.appendChild(n);context=this.context=n.getContext("webgl2",{preserveDrawingBuffer:true});let r=window.devicePixelRatio=typeof window.devicePixelRatio!=="undefined"&&window.devicePixelRatio!=null?window.devicePixelRatio:1;let i=function(t){let e=t[0].target;context.viewportWidth=context.canvas.width=e.clientWidth*r;context.viewportHeight=context.canvas.height=e.clientHeight*r;context.viewport(0,0,context.viewportWidth,context.viewportHeight);context.canvas.style.width=e.clientWidth+"px";context.canvas.style.height=e.clientHeight+"px"};new ResizeObserver(i).observe(t);let o=LoaderList.new().addLoaders(LoaderShader.new("https://brettonw.github.io/webgl.js/src/main/webapp/shaders/@.glsl").addVertexShaders("basic").addFragmentShaders(["basic","basic-texture","color","overlay","rgb","texture","vertex-color"]));if("loaders"in e){o.addLoaders(e.loaders)}let a=this;o.go(OnReady.new(null,function(t){Tetrahedron.make();Hexahedron.make();Octahedron.make();Icosahedron.make();Square.make();Sphere.makeN(2);Sphere.makeN(3);Sphere.makeN(5);Program.new({},"basic");Program.new({vertexShader:"basic"},"basic-texture");Program.new({vertexShader:"basic"},"color");Program.new({vertexShader:"basic"},"overlay");Program.new({vertexShader:"basic"},"rgb");Program.new({vertexShader:"basic"},"texture");Program.new({vertexShader:"basic"},"vertex-color");if(typeof e.onReady!=="undefined"){e.onReady.notify(a)}}))};t.save=function(t){let e="image/png";let n=this.context.canvas.toDataURL(e);let r=document.createElement("a");r.download=t+".png";r.href=n;r.dataset.downloadurl=[e,r.download,r.href].join(":");document.body.appendChild(r);r.click();document.body.removeChild(r)};t.use=function(){context=this.context};return t}();export let Loader=function(){let t=Object.create(ClassBase);t.construct=function(t){this.items=[];this.onReady=OnReady.new(this,this.finish);return this};t.addItem=function(t,e,n){n.onReady=this.onReady;let r={type:t,name:e,parameters:n};this.items.push(r);return this};t.finish=function(t){if(t===this.pendingItem){delete this.pendingItem;this.next()}else{}};t.go=function(t){this.onFinishedAll=t=typeof t!=="undefined"&&t!=null?t:{notify:function(t){}};this.next()};t.next=function(){if(this.items.length>0){let t=this.items.shift();this.pendingItem=t.type.new(t.parameters,t.name)}else{this.onFinishedAll.notify(this)}};return t}();export let LoaderList=function(){let t=Object.create(ClassBase);t.construct=function(t){this.items=[];this.onReady=OnReady.new(this,this.finish);return this};t.addLoaders=function(...e){if(Array.isArray(e[0])){e=e[0]}for(let t of e){this.items.push(t)}return this};t.finish=function(t){if(t===this.pendingItem){delete this.pendingItem;this.next()}else{}};t.next=function(){if(this.items.length>0){let t=this.items.shift();this.pendingItem=t;t.go(this.onReady)}else{this.onFinishedAll.notify(this)}};t.go=function(t){this.onFinishedAll=t=typeof t!=="undefined"&&t!=null?t:{notify:function(t){}};this.next()};return t}();export let LoaderPath=function(){let r=Object.create(Loader);r.construct=function(t){Object.getPrototypeOf(r).construct.call(this,t);this.type=t.type;this.path=t.path;return this};r.addItems=function(t,n){t=Array.isArray(t)?t:Array(1).fill(t);for(let e of t){let t=Object.assign(Object.create(null),n,{url:this.path.replace("@",e)});Object.getPrototypeOf(r).addItem.call(this,this.type,e,t)}return this};return r}();export let LoaderShader=function(){let e=Object.create(LoaderPath);e.construct=function(t){return Object.getPrototypeOf(e).construct.call(this,{type:Shader,path:t})};let n=function(e,n){e=Array.isArray(e)?e:Array(1).fill(e);let r=[];for(let t of e){r.push(n+"-"+t)}return r};const r=35633;e.addVertexShaders=function(t){return Object.getPrototypeOf(e).addItems.call(this,n(t,"vertex"),{type:r})};const i=35632;e.addFragmentShaders=function(t){return Object.getPrototypeOf(e).addItems.call(this,n(t,"fragment"),{type:i})};return e}();export let Shader=function(){let t=ClassNamed();t.construct=function(e){if(typeof e.type==="undefined")throw"Shader type Required";if(typeof e.url==="undefined")throw"Shader URL Required";let n=this;let r=new XMLHttpRequest;r.onload=function(t){if(r.status===200){let t=context.createShader(e.type);context.shaderSource(t,r.responseText);context.compileShader(t);if(!context.getShaderParameter(t,context.COMPILE_STATUS)){}else{n.compiledShader=t}}if(typeof e.onReady!=="undefined"){e.onReady.notify(n)}};r.open("GET",e.url);r.send()};return t}();export let Program=function(){let e=ClassNamed(CLASS_NAME_REQUIRED);e.POSITION_ATTRIBUTE="POSITION_ATTRIBUTE";e.NORMAL_ATTRIBUTE="NORMAL_ATTRIBUTE";e.TEXTURE_ATTRIBUTE="TEXTURE_ATTRIBUTE";e.COLOR_ATTRIBUTE="COLOR_ATTRIBUTE";e.MODEL_MATRIX_ATTRIBUTE="MODEL_MATRIX_ATTRIBUTE";let t;e.construct=function(t){t.vertexShader="vertex-"+(t.vertexShader=typeof t.vertexShader!=="undefined"&&t.vertexShader!=null?t.vertexShader:t.name);t.fragmentShader="fragment-"+(t.fragmentShader=typeof t.fragmentShader!=="undefined"&&t.fragmentShader!=null?t.fragmentShader:t.name);if(!("attributeMapping"in t)){t.attributeMapping={POSITION_ATTRIBUTE:"inputPosition",NORMAL_ATTRIBUTE:"inputNormal",TEXTURE_ATTRIBUTE:"inputTexture",COLOR_ATTRIBUTE:"inputColor",MODEL_MATRIX_ATTRIBUTE:"inputModelMatrix"}}if(!("parameterMapping"in t)){t.parameterMapping={MODEL_MATRIX_PARAMETER:"modelMatrix",VIEW_MATRIX_PARAMETER:"viewMatrix",PROJECTION_MATRIX_PARAMETER:"projectionMatrix",CAMERA_POSITION:"cameraPosition",OUTPUT_ALPHA_PARAMETER:"outputAlpha",TEXTURE_SAMPLER:"textureSampler",MODEL_COLOR:"modelColor",AMBIENT_LIGHT_COLOR:"ambientLightColor",AMBIENT_CONTRIBUTION:"ambientContribution",LIGHT_DIRECTION:"lightDirection",LIGHT_COLOR:"lightColor",DIFFUSE_CONTRIBUTION:"diffuseContribution",SPECULAR_CONTRIBUTION:"specularContribution",SPECULAR_EXPONENT:"specularExponent"}}this.currentShape=null;let i=this.program=context.createProgram();context.attachShader(i,Shader.get(t.vertexShader).compiledShader);context.attachShader(i,Shader.get(t.fragmentShader).compiledShader);context.bindAttribLocation(i,0,t.attributeMapping.POSITION_ATTRIBUTE);context.linkProgram(i);if(!context.getProgramParameter(i,context.LINK_STATUS)){}context.useProgram(i);let e=t.parameterMapping;let o=Utility.reverseMap(e);let a=this.standardParameterMapping=Object.create(null);for(let r=0,t=context.getProgramParameter(i,context.ACTIVE_UNIFORMS);r<t;r++){let e=ProgramUniform.new(i,r);let t=e.name;let n="set"+Utility.uppercase(t);this[n]=function(t){e.set(t);return this};if(t in o){a[o[t]]=n}}let r=Utility.reverseMap(t.attributeMapping);let s=this.attributes=Object.create(null);for(let n=0,t=context.getProgramParameter(i,context.ACTIVE_ATTRIBUTES);n<t;n++){let t=context.getActiveAttrib(i,n);let e=t.name;if(e in r){s[r[e]]=ProgramAttribute.new(i,t)}}};e.setStandardUniforms=function(e){let n=this.standardParameterMapping;for(let t in e){if(t in n){this[n[t]](e[t])}}return this};let n=function(t,e,n){if(e in t.attributes){context.bindBuffer(context.ARRAY_BUFFER,n);t.attributes[e].bind()}return t};e.bindPositionAttribute=function(t){return n(this,e.POSITION_ATTRIBUTE,t)};e.bindNormalAttribute=function(t){return n(this,e.NORMAL_ATTRIBUTE,t)};e.bindTextureAttribute=function(t){return n(this,e.TEXTURE_ATTRIBUTE,t)};e.bindColorAttribute=function(t){return n(this,e.COLOR_ATTRIBUTE,t)};e.bindModelMatrixAttribute=function(t){return n(this,e.MODEL_MATRIX_ATTRIBUTE,t)};e.unbindAttributes=function(){for(let t in this.attributes){this.attributes[t].unbind()}};e.getCurrentProgram=function(){return t};e.use=function(){if(t!==this){if(t){t.unbindAttributes()}t=this;context.useProgram(this.program);this.currentShape=null}return this};e.useShape=function(t){if(this.currentShape!==t){this.currentShape=t;return true}return false};return e}();let ProgramUniform=function(){let n=Object.create(null);n.construct=function(t,e){let n=context.getActiveUniform(t,e);this.name=n.name;this.type=n.type;this.location=context.getUniformLocation(t,n.name);if(this.type===context.SAMPLER_2D){this.textureIndex="nextTextureIndex"in t?t.nextTextureIndex:0;t.nextTextureIndex=this.textureIndex+1}else{}return this};n.set=function(t){switch(this.type){case 5124:context.uniform1i(this.location,t);break;case 35667:context.uniform2iv(this.location,t);break;case 35668:context.uniform3iv(this.location,t);break;case 35669:context.uniform4iv(this.location,t);break;case 5126:context.uniform1f(this.location,t);break;case 35664:context.uniform2fv(this.location,t);break;case 35665:context.uniform3fv(this.location,t);break;case 35666:context.uniform4fv(this.location,t);break;case 35674:context.uniformMatrix2fv(this.location,false,t);break;case 35675:context.uniformMatrix3fv(this.location,false,t);break;case 35676:context.uniformMatrix4fv(this.location,false,t);break;case 35678:context.activeTexture(context.TEXTURE0+this.textureIndex);context.bindTexture(context.TEXTURE_2D,Texture.get(t).texture);context.uniform1i(this.location,this.textureIndex);break}};n.new=function(t,e){return Object.create(n).construct(t,e)};return n}();let ProgramAttribute=function(){let n=Object.create(null);n.construct=function(t,e){this.name=e.name;this.type=e.type;this.location=context.getAttribLocation(t,this.name);switch(this.type){case 5124:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,1,context.INT,false,0,0)};break;case 35667:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,2,context.INT,false,0,0)};break;case 35668:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,3,context.INT,false,0,0)};break;case 35669:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,4,context.INT,false,0,0)};break;case 5126:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,1,context.FLOAT,false,0,0)};break;case 35664:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,2,context.FLOAT,false,0,0)};break;case 35665:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,3,context.FLOAT,false,0,0)};break;case 35666:this.bind=function(){context.enableVertexAttribArray(this.location);context.vertexAttribPointer(this.location,4,context.FLOAT,false,0,0)};break;case 35676:this.bind=function(){const e=16;const n=4*e;for(let t=0;t<4;++t){const r=this.location+t;const i=t*e;context.enableVertexAttribArray(r);context.vertexAttribPointer(r,4,context.FLOAT,false,n,i);context.vertexAttribDivisor(r,1)}};break}return this};n.unbind=function(){context.disableVertexAttribArray(this.location)};n.new=function(t,e){return Object.create(n).construct(t,e)};return n}();export let Texture=function(){let t=ClassNamed(CLASS_NAME_REQUIRED);let i;t.construct=function(t){i=typeof i!=="undefined"&&i!=null?i:function(){return context.getExtension("EXT_texture_filter_anisotropic")}();t.anisotropicFiltering=Math.min(context.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT),"anisotropicFiltering"in t?t.anisotropicFiltering:4);if(typeof t.url==="undefined")throw"Texture URL Required";let e=this.texture=context.createTexture();let n=new Image;n.crossOrigin="anonymous";let r=this;n.onload=function(){context.bindTexture(context.TEXTURE_2D,e);context.texImage2D(context.TEXTURE_2D,0,context.RGBA,context.RGBA,context.UNSIGNED_BYTE,n);context.texParameteri(context.TEXTURE_2D,context.TEXTURE_MAG_FILTER,context.LINEAR);if("generateMipMap"in t&&t.generateMipMap===true){context.texParameteri(context.TEXTURE_2D,context.TEXTURE_MIN_FILTER,context.LINEAR_MIPMAP_LINEAR);context.texParameterf(context.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY_EXT,t.anisotropicFiltering);context.generateMipmap(context.TEXTURE_2D)}else{context.texParameteri(context.TEXTURE_2D,context.TEXTURE_MIN_FILTER,context.LINEAR)}context.bindTexture(context.TEXTURE_2D,null);if(typeof t.onReady!=="undefined"){t.onReady.notify(r)}};n.src=t.url};return t}();export let Node=function(){let t=ClassNamed(CLASS_NAME_GENERATED);t.construct=function(t){let e=1;let n=2;let r=4;let i=8;let o=0;if("transform"in t){this.transform=t.transform;o+=e}if("state"in t){this.state=t.state;o+=n}if("shape"in t){this.shape=Shape.get(t.shape);if(typeof this.shape==="undefined"){}this.instanceTransforms=this.shape.createInstanceTransforms(t.instance);o+=r}this.enabled=t.enabled=typeof t.enabled!=="undefined"&&t.enabled!=null?t.enabled:true;if(!("children"in t)||t.children!==false){this.children=[];o+=i}let a=function(t){return this};this.traverse=[a,a,a,a,function(t){if(this.enabled){this.draw(t)}return this},function(t){if(this.enabled){t.MODEL_MATRIX_PARAMETER=Float4x4.multiply(this.transform,t.MODEL_MATRIX_PARAMETER);this.draw(t)}return this},function(t){if(this.enabled){this.state(t);this.draw(t)}return this},function(t){if(this.enabled){this.state(t);t.MODEL_MATRIX_PARAMETER=Float4x4.multiply(this.transform,t.MODEL_MATRIX_PARAMETER);this.draw(t)}return this},function(n){if(this.enabled){let e=n.MODEL_MATRIX_PARAMETER;for(let t of this.children){n.MODEL_MATRIX_PARAMETER=e;t.traverse(n)}}return this},function(n){if(this.enabled){let e=Float4x4.multiply(this.transform,n.MODEL_MATRIX_PARAMETER);for(let t of this.children){n.MODEL_MATRIX_PARAMETER=e;t.traverse(n)}}return this},function(n){if(this.enabled){this.state(n);let e=n.MODEL_MATRIX_PARAMETER;for(let t of this.children){n.MODEL_MATRIX_PARAMETER=e;t.traverse(n)}}return this},function(n){if(this.enabled){this.state(n);let e=Float4x4.multiply(this.transform,n.MODEL_MATRIX_PARAMETER);for(let t of this.children){n.MODEL_MATRIX_PARAMETER=e;t.traverse(n)}}return this},function(n){if(this.enabled){let e=n.MODEL_MATRIX_PARAMETER;this.draw(n);for(let t of this.children){n.MODEL_MATRIX_PARAMETER=e;t.traverse(n)}}return this},function(n){if(this.enabled){let e=n.MODEL_MATRIX_PARAMETER=Float4x4.multiply(this.transform,n.MODEL_MATRIX_PARAMETER);this.draw(n);for(let t of this.children){n.MODEL_MATRIX_PARAMETER=e;t.traverse(n)}}return this},function(n){if(this.enabled){this.state(n);let e=n.MODEL_MATRIX_PARAMETER;this.draw(n);for(let t of this.children){n.MODEL_MATRIX_PARAMETER=e;t.traverse(n)}}return this},function(n){if(this.enabled){this.state(n);let e=n.MODEL_MATRIX_PARAMETER=Float4x4.multiply(this.transform,n.MODEL_MATRIX_PARAMETER);this.draw(n);for(let t of this.children){n.MODEL_MATRIX_PARAMETER=e;t.traverse(n)}}return this}][o];return this};t.addChild=function(t){if("children"in this){this.children.push(t);t.parent=this}else{}return this};t.draw=function(t){Program.getCurrentProgram().setStandardUniforms(t);this.shape.instanceTransforms=this.instanceTransforms;this.shape.draw()};t.traverse=function(t){return this};t.getTransform=function(t){let e="transform"in this?this.transform:Float4x4.IDENTITY;if(typeof t!=="undefined"&&this==t||!("parent"in this)){return e}else{return Float4x4.multiply(e,this.parent.getTransform(t))}};return t}();export let Shape=function(){let t=ClassNamed(CLASS_NAME_REQUIRED);t.construct=function(t){let e=t.buffers();let n=function(t,e,n){let r=context.createBuffer();context.bindBuffer(t,r);context.bufferData(t,e,context.STATIC_DRAW);r.itemSize=n;r.numItems=e.length/n;return r};const r=1;const i=2;const o=4;const a=8;let s=0;if("position"in e){this.positionBuffer=n(context.ARRAY_BUFFER,new Float32Array(e.position),3)}else{}if("normal"in e){this.normalBuffer=n(context.ARRAY_BUFFER,new Float32Array(e.normal),3);s+=r}if("texture"in e){this.textureBuffer=n(context.ARRAY_BUFFER,new Float32Array(e.texture),2);s+=i}if("index"in e){this.indexBuffer=n(context.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.index),1);s+=o}if("color"in e){this.colorBuffer=n(context.ARRAY_BUFFER,new Float32Array(e.color),4);s+=a}this.draw=[function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindTextureAttribute(this.textureBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindTextureAttribute(this.textureBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindTextureAttribute(this.textureBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindTextureAttribute(this.textureBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindTextureAttribute(this.textureBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindTextureAttribute(this.textureBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data)}context.drawArraysInstanced(context.TRIANGLES,0,this.positionBuffer.numItems,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindTextureAttribute(this.textureBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}},function(){try{let t=Program.getCurrentProgram();if(t.useShape(this)){t.bindPositionAttribute(this.positionBuffer).bindNormalAttribute(this.normalBuffer).bindTextureAttribute(this.textureBuffer).bindColorAttribute(this.colorBuffer).bindModelMatrixAttribute(this.instanceTransforms.buffer);context.bufferSubData(context.ARRAY_BUFFER,0,this.instanceTransforms.data);context.bindBuffer(context.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}context.drawElementsInstanced(context.TRIANGLES,this.indexBuffer.numItems,context.UNSIGNED_SHORT,0,this.instanceTransforms.count)}catch(t){}}][s];return this};t.createInstanceTransforms=function(r){const n=4;const i=16;if(typeof r==="undefined"){r=1}if(typeof r==="number"||r.length===0){let n=[];for(let t=0,e=Math.max(1,r);t<e;++t){n.push(Float4x4.IDENTITY)}r=n}let o=r.length;let a={count:o,data:new Float32Array(o*i),matrices:[],buffer:function(){let t=context.createBuffer();context.bindBuffer(context.ARRAY_BUFFER,t);context.bufferData(context.ARRAY_BUFFER,o*i*n,context.DYNAMIC_DRAW);return t}()};for(let e=0;e<o;++e){const s=e*i*n;let t=new Float32Array(a.data.buffer,s,i);a.matrices.push(t);Float4x4.copy(r[e],t)}return a};return t}();export let Thing=function(){let t=ClassNamed(CLASS_NAME_GENERATED);t.construct=function(t){this.node=t.node;this.update=t.update};t.updateAll=function(e){t.forEach(function(t){t.update(e)})};return t}();export let TextFile=function(){let t=ClassNamed(CLASS_NAME_REQUIRED);t.construct=function(e){if(typeof e.url==="undefined")throw"TextFile URL Required";let n=this;let r=new XMLHttpRequest;r.onload=function(t){if(r.status===200){n.text=r.responseText}if(typeof e.onReady!=="undefined"){e.onReady.notify(n)}};r.open("GET",e.url);r.send()};return t}();export let ShapeBuilder=function(){let t=Object.create(null);t.construct=function(t){this.precision=t=typeof t!=="undefined"&&t!=null?t:7;this.vertexIndex=Object.create(null);this.vertices=[];this.faces=[];this.normals=[];this.texture=[];return this};t.addVertex=function(e){let n=Float3.str(e);if(n in this.vertexIndex){return this.vertexIndex[n]}else{let t=this.vertices.length;this.vertices.push(e);this.vertexIndex[n]=t;return t}};t.addVertexNormal=function(e,n){let r=Float3.str(e)+Float3.str(n);if(r in this.vertexIndex){return this.vertexIndex[r]}else{let t=this.vertices.length;this.vertices.push(e);this.normals.push(n);this.vertexIndex[r]=t;return t}};t.addVertexTexture=function(e,n){let r=Float3.str(e)+Float2.str(n);if(r in this.vertexIndex){return this.vertexIndex[r]}else{let t=this.vertices.length;this.vertices.push(e);this.texture.push(n);this.vertexIndex[r]=t;return t}};t.addVertexNormalTexture=function(e,n,r){let i=Float3.str(e)+Float3.str(n)+Float2.str(r);if(i in this.vertexIndex){return this.vertexIndex[i]}else{let t=this.vertices.length;this.vertices.push(e);this.normals.push(n);this.texture.push(r);this.vertexIndex[i]=t;return t}};t.addFace=function(t){this.faces.push(t)};t.makeBuffers=function(){let t={position:Utility.flatten(this.vertices),index:Utility.flatten(this.faces)};if(this.normals.length>0){t.normal=Utility.flatten(this.normals)}if(this.texture.length>0){t.texture=Utility.flatten(this.texture)}return t};t.makeFacets=function(){let s=[];let u=[];for(let a of this.faces){let t=this.vertices[a[0]];let e=this.vertices[a[1]];let n=this.vertices[a[2]];let r=Float3.normalize(Float3.subtract(e,t));let i=Float3.normalize(Float3.subtract(n,e));let o=Float3.cross(r,i);for(let t=0;t<a.length;++t){s.push(this.vertices[a[t]]);u.push(o)}}return{position:Utility.flatten(s),normal:Utility.flatten(u)}};t.new=function(t){return Object.create(ShapeBuilder).construct(t)};return t}();export let Primitive=function(){let t=Object.create(null);t.getShapeBuilder=function(){};t.makeFromBuilder=function(t,e){t=typeof t!=="undefined"&&t!=null?t:this.name;return Shape.new({buffers:function(){return e.makeFacets()}},t)};t.make=function(t){let e=this.getShapeBuilder();return this.makeFromBuilder(t,e)};return t}();export let Tetrahedron=function(){let t=Object.create(Primitive);t.name="tetrahedron";t.getShapeBuilder=function(){let t=ShapeBuilder.new();t.addVertex([1,1,1]);t.addVertex([-1,1,-1]);t.addVertex([-1,-1,1]);t.addVertex([1,-1,-1]);t.addFace([0,1,2]);t.addFace([1,3,2]);t.addFace([2,3,0]);t.addFace([3,1,0]);return t};return t}();export let Hexahedron=function(){let t=Object.create(Primitive);t.name="cube";t.getShapeBuilder=function(){let t=ShapeBuilder.new();t.addVertex([-1,-1,-1]);t.addVertex([-1,1,-1]);t.addVertex([1,1,-1]);t.addVertex([1,-1,-1]);t.addVertex([-1,-1,1]);t.addVertex([-1,1,1]);t.addVertex([1,1,1]);t.addVertex([1,-1,1]);t.addFace([0,1,2,0,2,3]);t.addFace([7,6,5,7,5,4]);t.addFace([1,5,6,1,6,2]);t.addFace([4,0,3,4,3,7]);t.addFace([4,5,1,4,1,0]);t.addFace([3,2,6,3,6,7]);return t};return t}();export let Octahedron=function(){let t=Object.create(Primitive);t.name="octahedron";t.getShapeBuilder=function(){let t=ShapeBuilder.new();t.addVertex([0,1,0]);t.addVertex([1,0,0]);t.addVertex([0,0,1]);t.addVertex([-1,0,0]);t.addVertex([0,0,-1]);t.addVertex([0,-1,0]);t.addFace([0,2,1]);t.addFace([0,3,2]);t.addFace([0,4,3]);t.addFace([0,1,4]);t.addFace([5,1,2]);t.addFace([5,2,3]);t.addFace([5,3,4]);t.addFace([5,4,1]);return t};return t}();export let Icosahedron=function(){let t=Object.create(Primitive);t.name="icosahedron";t.getShapeBuilder=function(){let t=ShapeBuilder.new();let e=(1+Math.sqrt(5))/2;let n=1/e;e=1;t.addVertex([-n,e,0]);t.addVertex([n,e,0]);t.addVertex([-n,-e,0]);t.addVertex([n,-e,0]);t.addVertex([0,-n,e]);t.addVertex([0,n,e]);t.addVertex([0,-n,-e]);t.addVertex([0,n,-e]);t.addVertex([e,0,-n]);t.addVertex([e,0,n]);t.addVertex([-e,0,-n]);t.addVertex([-e,0,n]);t.addFace([0,11,5]);t.addFace([0,5,1]);t.addFace([0,1,7]);t.addFace([0,7,10]);t.addFace([0,10,11]);t.addFace([1,5,9]);t.addFace([5,11,4]);t.addFace([11,10,2]);t.addFace([10,7,6]);t.addFace([7,1,8]);t.addFace([3,9,4]);t.addFace([3,4,2]);t.addFace([3,2,6]);t.addFace([3,6,8]);t.addFace([3,8,9]);t.addFace([4,9,5]);t.addFace([2,4,11]);t.addFace([6,2,10]);t.addFace([8,6,7]);t.addFace([9,8,1]);return t};return t}();export let Square=function(){let t=Object.create(Primitive);t.name="square";t.makeFromBuilder=function(t,e){t=typeof t!=="undefined"&&t!=null?t:this.name;return Shape.new({buffers:function(){return e.makeBuffers()}},t)};t.getShapeBuilder=function(){let t=ShapeBuilder.new();t.addVertexNormalTexture([1,1,0],[0,0,1],[1,0]);t.addVertexNormalTexture([-1,1,0],[0,0,1],[0,0]);t.addVertexNormalTexture([-1,-1,0],[0,0,1],[0,1]);t.addVertexNormalTexture([1,-1,0],[0,0,1],[1,1]);t.addFace([0,1,2,0,2,3]);return t};return t}();export let Sphere=function(){let t=Object.create(Primitive);t.name="sphere";t.parameters={baseShapeBuilderType:Icosahedron,subdivisions:4};t.getShapeBuilder=function(){let i=ShapeBuilder.new();let o=function(t){return i.addVertex(Float3.normalize(t))};let e=this.parameters.baseShapeBuilderType.getShapeBuilder();for(let t of e.vertices){o(t)}let a=i.vertices;let s=i.faces=e.faces;let n=function(){let t=s.splice(0,1)[0];let e=o(Float3.add(a[t[0]],a[t[1]]));let n=o(Float3.add(a[t[1]],a[t[2]]));let r=o(Float3.add(a[t[2]],a[t[0]]));i.addFace([t[0],e,r]);i.addFace([t[1],n,e]);i.addFace([t[2],r,n]);i.addFace([e,n,r])};for(let t=0;t<this.parameters.subdivisions;++t){for(let t=0,e=s.length;t<e;++t){n()}}return i};t.makeFromBuilder=function(t,e){t=typeof t!=="undefined"&&t!=null?t:this.name;return Shape.new({buffers:function(){let t=e.makeBuffers();t.normal=t.position;return t}},t)};t.makeN=function(t){this.parameters.subdivisions=t;this.make(this.name+t)};return t}();let makeNormal=function(r){let i=r.length-1;let o=[];let a=function(t,e){let n=Float2.subtract(t,e);let r=Float2.perpendicular(n);o.push(Float2.normalize(r))};if(Float2.equals(r[0],r[i])){for(let n=0;n<=i;++n){let t=r[(n-1+i)%i];let e=r[(n+1)%i];a(t,e)}}else{for(let n=0;n<=i;++n){let t=r[n===0?n:n-1];let e=r[n===i?n:n+1];a(t,e)}}return o};export let makeRevolve=function(t,r,b,p,T){let R=1e-6;let E=r.length-1;b=typeof b!=="undefined"&&b!=null?b:makeNormal(r);T=typeof T!=="undefined"&&T!=null?T:function(t){return t};return Shape.new({buffers:function(){let A=ShapeBuilder.new();let n=-2*Math.PI/p;for(let m=0;m<p;++m){let l=m+1;let t=m*n,f=Math.cos(t),d=Math.sin(t);let e=l%p*n,h=Math.cos(e),x=Math.sin(e);for(let c=0;c<E;++c){let i=c+1;let o=r[c],a=b[c];let s=r[i],u=b[i];if(Float2.norm(Float2.subtract(o,s))>R){let t=(o[0]<R?0:2)+(s[0]<R?0:1);switch(t){case 0:break;case 1:{let t=A.addVertexNormalTexture([0,o[1],0],[a[0]*f,a[1],a[0]*d],[m/p,T(c/E)]);let e=A.addVertexNormalTexture([s[0]*f,s[1],s[0]*d],[u[0]*f,u[1],u[0]*d],[m/p,T(i/E)]);let n=A.addVertexNormalTexture([s[0]*h,s[1],s[0]*x],[u[0]*h,u[1],u[0]*x],[l/p,T(i/E)]);A.addFace([t,e,n]);break}case 2:{let t=A.addVertexNormalTexture([o[0]*f,o[1],o[0]*d],[a[0]*f,a[1],a[0]*d],[m/p,T(c/E)]);let e=A.addVertexNormalTexture([o[0]*h,o[1],o[0]*x],[a[0]*h,a[1],a[0]*x],[l/p,T(c/E)]);let n=A.addVertexNormalTexture([0,s[1],0],[u[0]*f,u[1],u[0]*d],[m/p,T(i/E)]);A.addFace([t,n,e]);break}case 3:{let t=A.addVertexNormalTexture([o[0]*f,o[1],o[0]*d],[a[0]*f,a[1],a[0]*d],[m/p,T(c/E)]);let e=A.addVertexNormalTexture([s[0]*f,s[1],s[0]*d],[u[0]*f,u[1],u[0]*d],[m/p,T(i/E)]);let n=A.addVertexNormalTexture([o[0]*h,o[1],o[0]*x],[a[0]*h,a[1],a[0]*x],[l/p,T(c/E)]);let r=A.addVertexNormalTexture([s[0]*h,s[1],s[0]*x],[u[0]*h,u[1],u[0]*x],[l/p,T(i/E)]);A.addFace([n,t,r,r,t,e]);break}}}}}return A.makeBuffers()}},t)};export let makeBall=function(t,e){let r=[];let i=[];let o=Math.PI/e;for(let n=0;n<=e;++n){let t=o*n;let e=Float2.fixNum([Math.sin(t),Math.cos(t)]);r.push(e);i.push(e)}return makeRevolve(t,r,i,e*2)};export let makeSimpleExtrude=function(t,e,n,r,i){n=typeof n!=="undefined"&&n!=null?n:2;r=typeof r!=="undefined"&&r!=null?r:makeNormal(e);return Shape.new({buffers:function(){let l=ShapeBuilder.new();let t=1e-6;let f=n/2;let d=e.length-1;for(let c=0;c<d;++c){let i=c+1;let o=e[c],a=r[c];let s=e[i],u=r[i];if(Float2.norm(Float2.subtract(o,s))>t){let t=l.addVertexNormalTexture([o[0],o[1],-f],[a[0],a[1],0],[0,c/d]);let e=l.addVertexNormalTexture([o[0],o[1],f],[a[0],a[1],0],[1,c/d]);let n=l.addVertexNormalTexture([s[0],s[1],-f],[u[0],u[1],0],[0,i/d]);let r=l.addVertexNormalTexture([s[0],s[1],f],[u[0],u[1],0],[1,i/d]);l.addFace([t,e,r,n,t,r])}}return l.makeBuffers()}},t)};